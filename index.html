<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="icon" href="Other/SmallSwords.png?v=2" type="image/png" />
	<link rel="apple-touch-icon" href="Other/BigSwords.png?v=2" type="image/png" />

	<meta charset="UTF-8"/>
	<meta name="description" content="Welcome to the unofficial Polytopia battle calculator! Try out a variety of combat situations and see what the end result is going to be." />
	<meta name="author" content="Sierk Rosema" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<meta property="og:url" content="https://frothfrenzy.github.io/polytopiacalculator/" />
	<meta property="og:type" content="website" />
	<meta property="og:title" content="Polytopia Battle Calculator" />
	<meta property="og:description" content="Welcome to a Polytopia battle calculator! Try out a variety of combat situations and see what the end result is going to be." />
	<meta property="og:image" content="https://frothfrenzy.github.io/polytopiacalculator/Other/BigSwords.png" />

	<title>Polytopia Battle Calculator</title>

<style>
h2
{
	display: inline;
}
p
{
	max-height: 999999px;
	font-size: 17px;
	margin-top: 12px;
	margin-bottom: 12px;
}
p.ext
{
	font-size: 16px;
}
p.i
{
	font-style: italic;
}
div.a
{
	border-bottom: 1px solid;
	float: left;
	display: none;
	width: 100%;
}
div.c
{
	font-size: 13px;
	max-height: 999999px;
}
div.ei
{
	text-align: right;
	padding-right: 8px;
	float: right;
	width: 1%;
}
div.p
{
	font-size: 17px;
	float: left;
	width: 92%;
}
div.q
{
	border-bottom: 1px solid;
	padding-top: 14px;
	padding-bottom: 14px;
	float: left;
	width: 100%
}
.textpress
{
	padding-top: 4px;
	padding-bottom: 4px;
}
.textpress:active
{
	background-color: lightgray;
}
#respressindicator
{
	visibility: hidden;
}
#resultcontainer:active #respressindicator
{
	visibility: visible;
}
.container
{
	display: inline-block;
	position: relative;
	cursor: pointer;
	height: 40px;
	font-size: 17px;
	border: 1px solid #A9A9A9;
	padding-top: 10px;
	padding-bottom: 6px;
	padding-left: 2px;
	padding-right: 2px;
	box-sizing: border-box;
	-moz-appearance:none;
	-webkit-appearance: none;
	appearance:none;
}
.container:active
{
	background-color: lightgray;
}
.shiphpcontainer
{
	display: inline-block;
	cursor: pointer;
	font-size: 17px;
	border: 1px solid #A9A9A9;
	width: 39px;
	height: 40px;
	padding-top: 10px;
	padding-bottom: 6px;
	padding-left: 2px;
	padding-right: 2px;
	text-align: center;
	box-sizing: border-box;
	-moz-appearance:none;
	-webkit-appearance: none;
	appearance:none;
}
.shiphpcontainer:active
{
	background-color: lightgray;
}
.creationcontainer
{
	display: inline-block;
	cursor: pointer;
	font-size: 17px;
	border: 1px solid #A9A9A9;
	width: 28px;
	padding-top: 4px;
	padding-bottom: 4px;
	padding-left: 1px;
	padding-right: 1px;
	-moz-appearance:none;
	-webkit-appearance: none;
	appearance:none;
}
.container input
{
	position: absolute;
	cursor: pointer;
	height: 0;
	width: 0;
}
.checkmark
{
	position: absolute;
	height: 18px;
	width: 18px;
	top: 10px;
	right: 2px;
	background-color: #eee;
	border: 1px solid #696969;
	border-radius: 5px;
}
.checkmark:after
{
	content: "";
	position: absolute;
	display: none;
}
.container input:checked ~ .checkmark:after
{
	display: block;
}
.container .checkmark:after
{
	left: 6px;
	top: 2px;
	width: 4px;
	height: 9px;
	border: solid black;
	border-width: 0 3px 3px 0;
	transform: rotate(45deg);
	-webkit-transform: rotate(45deg);
	-ms-transform: rotate(45deg);
}
input[type=number]
{
	display: inline-block;
	border: 1px solid #A9A9A9;
	padding-top: 4px;
	padding-bottom: 4px;
	padding-left: 1px;
	padding-right: 1px;
	border-radius: 0;
	font-size: 17px;
	-moz-appearance:none;
	-webkit-appearance: none;
	appearance:none;
}
select
{
	position: relative;
	width: 135px;
	height: 40px;
	font-size: 17px;
	display: inline-block;
	border: 1px solid #A9A9A9;
	padding-left: 1px;
	padding-right: 2px;
	padding-top: 5px;
	padding-bottom: 5px;
	border-radius: 0;
	background: url(Other/DownArrow.png) no-repeat right;
	box-sizing: border-box;
	-moz-appearance:none;
	-webkit-appearance: none;
	appearance:none;
}
select::-ms-expand
{
	display: none;
}
button
{
	font-size: 17px;
	background-color: #eee;
	color: black;
	padding: 7px 11px;
	border: 1px solid #696969;
	border-radius: 5px;
	cursor: pointer;
}
button:active
{
	background-color: lightgray;
}
</style>

</head>

<body onload="loadelements()">
<script>
var extinfo = [];
var tapcounter = 0;
var entries = 10;
var attackers = [];
var defenders = [];
var attackerselected = -1;
var defenderselected = -1;
var prevattackerselected = -2;
var prevdefenderselected = -2;
var deleteselected = false;
var healselected = false;
var backupattackers = [];
var backupdefenders = [];
var firstbackup = false;
var noretalswitch = true;
var answersexpanded = 0;
var refreshcounter = 0;
var refatthpcounter = 0;
var refdefhpcounter = 0;
var shortparameter = false;
var savednumber = 0;
var prevattshiphp = 10;
var prevdefshiphp = 10;
var freezecounter = 0;

function messageclear()
{
	document.getElementById("resultatt").innerHTML = "";
	document.getElementById("resultdef").innerHTML = "";
	document.getElementById("resultsplash").innerHTML = "";
	document.getElementById("note").innerHTML = "";
	document.getElementById("frozennote").innerHTML = "";
}
function calculate(mode)
{
	var attforce, defforce, totaldam, res, testdef, multitestdef;
	var astring, bstring, cstring, unit1, unit2, defbonus = "";
	var warning = false;

	if (mode == "Multi")
	{
		var att = attackers[attackerselected].a;
		var def = defenders[defenderselected].d;
		var atthp = parseInt(attackers[attackerselected].hp);
		var defhp = parseInt(defenders[defenderselected].hp);
		var splashhp = parseInt(defenders[defenderselected].hp);
		var attorighp = parseInt(attackers[attackerselected].originalhp);
		var attmaxhp = attackers[attackerselected].maxhp;
		var defmaxhp = defenders[defenderselected].maxhp;
		var attname = attackers[attackerselected].type;
		var defname = defenders[defenderselected].type;
	}
	else
	{
		var att = parseFloat(document.getElementById("attack").value);
		var def = parseFloat(document.getElementById("defense").value);
		var atthp = parseInt(document.getElementById("attackhp").value);
		var defhp = parseInt(document.getElementById("defensehp").value);
		var splashhp = parseInt(document.getElementById("defensehp").value);
		var attmaxhp = parseInt(document.getElementById("attackmaxhp").value);
		var defmaxhp = parseInt(document.getElementById("defensemaxhp").value);
		var attname = document.getElementById("selectattacker").value;
		var defname = document.getElementById("selectdefender").value;
	}
	resetcounters();
	if (atthp == 123)
	{
		messageclear();
		warning = true;
		defhp = parseInt(document.getElementById("defensehp").value);
		if (defhp == 0)
		{
			document.getElementById("resultatt").innerHTML = "Combat history must contain at least 1 entry!";
			scrollanchor.scrollIntoView(false);
		}
		else
		{
			if (defhp == 1)
			{
				document.getElementById("resultatt").innerHTML = "Combat history limit set to 1 entry!";
			}
			else
			{
				document.getElementById("resultatt").innerHTML = "Combat history limit set to " +  defhp + " entries!";
			}
			extinfo.splice (defhp, (extinfo.length - 1));
			document.getElementById("extendedinfo").innerHTML = extinfo.join("");
			entries = defhp;
			if (extinfo.length == 0)
			{
			document.getElementById("extendedinfo").innerHTML = "<span style='border-top: 1px dashed black; padding-top: 10px; display: block; max-width: 350px;'></span><span class='ext'>Battle history does not contain any entries yet.</span>";
			}
			scrollanchor.scrollIntoView(false);
		}
	}
	if ((mode != "Multi") && (warning != true))
	{
		if (isNaN(att) == true || isNaN(def) == true || isNaN(atthp) == true ||
			  isNaN(defhp) == true || isNaN(attmaxhp) == true || isNaN(defmaxhp) == true)
		{
			warning = true;
			messageclear();
			document.getElementById("resultatt").innerHTML = "All of the fields have to be filled with numbers!";
			scrollanchor.scrollIntoView(false);
		}
		else if (att < 0 || def < 0 || atthp < 1 || defhp < 1 || attmaxhp < 10 || defmaxhp < 10 || atthp > attmaxhp || defhp > defmaxhp ||
			(att % 0.5 != 0) || (def % 0.5 != 0) || (document.getElementById("attackhp").value % atthp != 0) || (document.getElementById("defensehp").value % defhp != 0) || 
				(document.getElementById("attackmaxhp").value % attmaxhp != 0) || (document.getElementById("defensemaxhp").value % defmaxhp != 0))
		{
			warning = true;
			messageclear();
			document.getElementById("resultatt").innerHTML = "One or more invalid inputs:<br/>";
			if (att < 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attack value must be 0 or higher");
			}
			else if (att % 0.5 != 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attack value must be divisible by 0.5");
			}
			if (atthp < 1)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker current HP can't be lower than 1");
			}
			else if (document.getElementById("attackhp").value % atthp != 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker current HP must be a whole number");
			}
			else if (atthp > attmaxhp && atthp > 0 && attmaxhp >= 10)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker current HP cannot exceed max HP");
			}
			if (attmaxhp < 10)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker max HP must be 10 or higher");
			}
			else if (document.getElementById("attackmaxhp").value % attmaxhp != 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker max HP must be a whole number");
			}
			if (def < 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defense value must be 0 or higher");
			}
			else if (def % 0.5 != 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defense value must be divisible by 0.5");
			}
			if (defhp < 1)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender current HP can't be lower than 1");
			}
			else if (document.getElementById("defensehp").value % defhp != 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender current HP must be a whole number");
			}
			else if (defhp > defmaxhp && defhp > 0 && defmaxhp >= 10)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender current HP cannot exceed max HP");
			} 
			if (defmaxhp < 10)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender max HP must be 10 or higher");
			}
			else if (document.getElementById("defensemaxhp").value % defmaxhp != 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender max HP must be a whole number");
			}
			scrollanchor.scrollIntoView(false);
		}
	}
	if (warning != true)
	{
		messageclear();
		testdef = false;
		if (mode == "Multi")
		{
			multitestdef = defenders[defenderselected].defbonus;
			if (multitestdef == "D")
			{
				testdef = true;
			}
		}
		else
		{
			testdef = document.getElementById("def1").checked;
		}
		if ((mode == "Multi") && (attname == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
		{
			atthp = attorighp;
		}
		attforce = att * (atthp / attmaxhp);
		defforce = def * (defhp / defmaxhp);

		if (testdef == true)
		{
			if (defname == "Catapult")
			{
				document.getElementById("note").innerHTML = "Note: Catapults can't benefit any from defense bonuses due to their 0 defense value!";
			}
			else if (defname == "Mind Bender")
			{
				defforce = defforce * 1.5;
				document.getElementById("note").innerHTML = "Note: Mind Benders don't receive the defense bonus from cities!";
			}
			else if (defname == "Giant")
			{
				defforce = defforce * 1.5;
				document.getElementById("note").innerHTML = "Note: Giants don't receive the defense bonus from cities!";
			}
			else if (defname == "Navalon")
			{
				defforce = defforce * 1.5;
				document.getElementById("note").innerHTML = "Note: Navalons don't receive the defense bonus from cities!";
			}
			else if (defname == "Baby Dragon")
			{
				defforce = defforce * 1.5;
				document.getElementById("note").innerHTML = "Note: Baby Dragons don't receive the defense bonus from cities!";
			}
			else if (defname == "Fire Dragon")
			{
				defforce = defforce * 1.5;
				document.getElementById("note").innerHTML = "Note: Fire Dragons don't receive the defense bonus from cities!";
			}
			else if (defname == "Crab")
			{
				defforce = defforce * 1.5;
				document.getElementById("note").innerHTML = "Note: Crabs don't receive the defense bonus from cities!";
			}
			else if (defname == "Mooni")
			{
				defforce = defforce * 1.5;
				document.getElementById("note").innerHTML = "Note: Moonies don't receive the defense bonus from cities!";
			}
			else if (defname == "Battle Sled")
			{
				defforce = defforce * 1.5;
				document.getElementById("note").innerHTML = "Note: Battle Sleds don't receive the defense bonus from cities!";
			}
			else if (defname == "Ice Fortress")
			{
				defforce = defforce * 1.5;
				document.getElementById("note").innerHTML = "Note: Ice Fortresses don't receive the defense bonus from cities!";
			}
			else if (defname == "Gaami")
			{
				defforce = defforce * 1.5;
				document.getElementById("note").innerHTML = "Note: Gaamis don't receive the defense bonus from cities!";
			}
			else if (defname == "Nature Bunny")
			{
				document.getElementById("note").innerHTML = "Note: Nature Bunnies can't capture cities and don't have any defensive technologies! Defense bonus was disregarded in the result.";
			}
			else
			{
				defforce = defforce * 1.5;
				defbonus = "|D";
			}
		}
		testdef = false;
		if (mode == "Multi")
		{
			multitestdef = defenders[defenderselected].defbonus;
			if (multitestdef == "W")
			{
				testdef = true;
			}
		}
		else
		{
			testdef = document.getElementById("def2").checked;
		}
		if (testdef == true)
		{
			if (defname == "Boat" || defname == "Ship" || defname == "Battleship")
			{
				document.getElementById("note").innerHTML = "Note: Ships can't benefit from walls! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Catapult")
			{
				document.getElementById("note").innerHTML = "Note: Catapults can't benefit from any defense bonuses due to their 0 defense value!";
			}
			else if (defname == "Mind Bender")
			{
				document.getElementById("note").innerHTML = "Note: Mind Benders don't receive the defense bonus from cities! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Giant")
			{
				document.getElementById("note").innerHTML = "Note: Giants don't receive the defense bonus from cities! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Navalon")
			{
				document.getElementById("note").innerHTML = "Note: Navalons don't receive the defense bonus from cities! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Baby Dragon")
			{
				document.getElementById("note").innerHTML = "Note: Baby Dragons don't receive the defense bonus from cities! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Fire Dragon")
			{
				document.getElementById("note").innerHTML = "Note: Fire Dragons don't receive the defense bonus from cities! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Crab")
			{
				document.getElementById("note").innerHTML = "Note: Crabs don't receive the defense bonus from cities! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Mooni")
			{
				document.getElementById("note").innerHTML = "Note: Moonies don't receive the defense bonus from cities! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Battle Sled")
			{
				document.getElementById("note").innerHTML = "Note: Battle Sleds don't receive the defense bonus from cities! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Ice Fortress")
			{
				document.getElementById("note").innerHTML = "Note: Ice Fortresses don't receive the defense bonus from cities! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Gaami")
			{
				document.getElementById("note").innerHTML = "Note: Gaamis don't receive the defense bonus from cities! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Nature Bunny")
			{
				document.getElementById("note").innerHTML = "Note: Nature Bunnies can't capture cities! Wall bonus was disregarded in the result.";
			}
			else
			{
				defforce = defforce * 4;
				defbonus = "|W";
			}
		}
		
		unit1 = attname + " " + att + "|" + atthp + "|" + attmaxhp + " - ";
		unit2 = defname + " " + def + "|" + defhp + "|" + defmaxhp + defbonus;
			
		totaldam = attforce + defforce;
		res = Math.round(attforce / totaldam * att * 4.5);
		if (isNaN(res) == true)
		{
			res = 0;
		}
		if (attname == "Fire Dragon")
		{
			splashhp = splashhp - Math.floor(res / 2);
			if (splashhp > 0)
			{
				if (mode != "Multi")
				{
					cstring = document.getElementById("resultsplash").innerHTML = "<p><i>IF SPLASHED:</i></p>Defender survives! Remaining HP:  " + splashhp;
				}
				else if (attackers[attackerselected].defendersattacked.length > 0)
				{
					cstring = document.getElementById("resultsplash").innerHTML = "<i>Fire Dragon's splash attack.</i>";
				}
				else if (attackers[attackerselected].defendersattacked.length < 1)
				{
					if (document.getElementById("noretalbox").checked == true)
					{
						cstring = document.getElementById("resultsplash").innerHTML = "<i><p>Fire Dragon's main attack.</p>No enemy retaliation.</i>";
					}
					else
					{
						cstring = document.getElementById("resultsplash").innerHTML = "<i>Fire Dragon's main attack.</i>";
					}
				}
			}
			else
			{
				if (mode != "Multi")
				{
					cstring = document.getElementById("resultsplash").innerHTML = "<p><i>IF SPLASHED:</i></p>Defender is DESTROYED! Afterlife HP:  " + splashhp;
				}
				else if (attackers[attackerselected].defendersattacked.length > 0)
				{
					cstring = document.getElementById("resultsplash").innerHTML = "<i>Fire Dragon's splash attack.</i>";
				}
				else if (attackers[attackerselected].defendersattacked.length < 1)
				{
					if (document.getElementById("noretalbox").checked == true)
					{
						cstring = document.getElementById("resultsplash").innerHTML = "<i><p>Fire Dragon's main attack.</p>No enemy retaliation.</i>";
					}
					else
					{
						cstring = document.getElementById("resultsplash").innerHTML = "<i>Fire Dragon's main attack.</i>";
					}
				}
			}	
		}
		if ((attname == "Fire Dragon") && (mode == "Multi"))
		{
			if (attackers[attackerselected].defendersattacked.length > 0)
			{
				defhp = splashhp;
			}
			else
			{
				defhp = defhp - res;
			}
		}
		else
		{
			defhp = defhp - res;
		}

		if (mode != "Multi")
		{
			if (defhp > 0) 
			{
				if (attname == "Ice Archer")
				{
					bstring = document.getElementById("resultdef").innerHTML = "Defender is FROZEN! Remaining HP:  " + defhp;
					document.getElementById("frozennote").innerHTML = "Frozen units can't retaliate!";
				}
				else
				{
					bstring = document.getElementById("resultdef").innerHTML = "Defender survives! Remaining HP:  " + defhp;
					document.getElementById("defensehp").value = defhp;
				}
				res = Math.round(defforce / totaldam * def * 4.5);
				if (isNaN(res) == true)
				{
					res = 0;
				}
				if (attname == "Ice Archer" || defname == "Mooni" || defname == "Ice Archer")
				{
					res = 0;
					if (defname == "Mooni")
					{
						document.getElementById("frozennote").innerHTML = "Moonies can't retaliate!";
					}
					if (defname == "Ice Archer")
					{
						document.getElementById("frozennote").innerHTML = "Ice Archers can't retaliate!";
					}
				}
				atthp = atthp - res;
				if (atthp > 0)
				{
					astring = document.getElementById("resultatt").innerHTML = "Attacker survives! Remaining HP:  " + atthp;
				}
				else
				{
					astring = document.getElementById("resultatt").innerHTML = "Attacker is DESTROYED! Afterlife HP:  " + atthp;
				}
			}
			else
			{
				bstring = document.getElementById("resultdef").innerHTML = "Defender is DESTROYED! Afterlife HP:  " + defhp;
				egg(att);
			}	
		}	

		if (mode == "Multi")
		{
			if (defhp > 0) 
			{
				if (attname == "Ice Archer")
				{
					bstring = document.getElementById("resultdef").innerHTML = "Defender is FROZEN! Remaining HP:  " + defhp;
					document.getElementById("frozennote").innerHTML = "Frozen units can't retaliate!";
					defenders[defenderselected].frozen = true;
				}
				
				else
				{
					if (defenders[defenderselected].frozen == true)
					{
						bstring = document.getElementById("resultdef").innerHTML = "Defender is FROZEN! Remaining HP:  " + defhp;
					}
					else
					{
						bstring = document.getElementById("resultdef").innerHTML = "Defender survives! Remaining HP:  " + defhp;
					}
					defenders[defenderselected].hp = defhp;
					res = Math.round(defforce / totaldam * def * 4.5);
					if (defenders[defenderselected].frozen == true)
					{
						res = 0;
						document.getElementById("frozennote").innerHTML = "Frozen units can't retaliate!";
					}
					else if (defname == "Mooni" || defname == "Ice Archer")
					{
						res = 0;
						if (defname == "Mooni" && attackers[attackerselected].defendersattacked.length == 0)
						{
							document.getElementById("note").innerHTML = "Moonies can't retaliate!";
						}
						if (defname == "Ice Archer" && attackers[attackerselected].defendersattacked.length == 0)
						{
							document.getElementById("note").innerHTML = "Ice Archers can't retaliate!";
						}
					}
				}
				if (isNaN(res) == true)
				{
					res = 0;
				}
				if (document.getElementById("noretalbox").checked == false)
				{
					if ((attname == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
					{
					}
					else
					{
						atthp = atthp - res;
					}
				}
				if (atthp > 0)
				{
					if ((attname == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
					{
					}
					else
					{
						astring = document.getElementById("resultatt").innerHTML = "Attacker survives! Remaining HP:  " + atthp;
						attackers[attackerselected].hp = atthp;
					}
				}
				else
				{
					if ((attname == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
					{
					}
					else
					{
						astring = document.getElementById("resultatt").innerHTML = "Attacker is DESTROYED! Afterlife HP:  " + atthp;
						attackers[attackerselected].hp = atthp;
					}
				}
			}
			else
			{
				bstring = document.getElementById("resultdef").innerHTML = "Defender is DESTROYED! Afterlife HP:  " + defhp;
				defenders[defenderselected].hp = defhp;
			}

			if ((attackers[attackerselected].type != "Knight") && (attackers[attackerselected].type != "Navalon") && (attackers[attackerselected].type != "Fire Dragon"))
			{
				attackers[attackerselected].unavailable = true;
			}
			else if (attackers[attackerselected].type == "Fire Dragon")
			{
				attackers[attackerselected].defendersattacked.push(defenderselected);
				document.getElementById("noretaltext").style.visibility = "hidden";
			}
			else
			{	
				if ((defhp > 0) || (atthp < 1))
				{
					attackers[attackerselected].unavailable = true;
				}
				else
				{
					attackers[attackerselected].defendersattacked.push(defenderselected);
				}
			}

			var decshort = "";
			var color = "black";
			if (attackers[attackerselected].type == "Knight")
			{
				decshort = "<b>3</b>";
			}
			else
			{
				decshort = attackers[attackerselected].a;
			}
			if ((attackers[attackerselected].hp < 1) || (attackers[attackerselected].unavailable == true))
			{
				color = "gray";
			}
			var splashindicator = ""
			if ((attackers[attackerselected].type == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
			{
				splashindicator = "S";
			}
			document.getElementById("attacker" + attackerselected).innerHTML = "<img src='Attackers/" + attackers[attackerselected].type + ".png' height='55' width='55'><div id='splash" + attackerselected + "' style='position: absolute; top: 1px; right: 1px'><b>" + splashindicator + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[attackerselected].hp + "/" + attackers[attackerselected].maxhp + "</div>";
			document.getElementById("attacker" + attackerselected).style.borderColor = color;

			color = "black"
			if (defenders[defenderselected].hp < 1)
			{
				color = "gray";
			}
			else if (defenders[defenderselected].frozen == true)
			{
				color = "blue";
			}
			document.getElementById("defender" + defenderselected).innerHTML ="<img src='Defenders/" + defenders[defenderselected].type + ".png' height='55' width='55'><div style='position: absolute; top: 1px; right: 1px'><b>" + defenders[defenderselected].defbonus + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + defenders[defenderselected].d + "/" + defenders[defenderselected].hp + "/" + defenders[defenderselected].maxhp + "</div>";
			document.getElementById("defender" + defenderselected).style.borderColor = color;

		}
		if ((mode == "Multi") && (attackers[attackerselected].type != "Fire Dragon") && (document.getElementById("noretalbox").checked == true) && (defenders[defenderselected].hp > 0))
		{
			cstring = document.getElementById("resultsplash").innerHTML = "<i>No enemy retaliation.</i>";	
		}
		if (mode == "Multi")
		{
			if ((attackers[attackerselected].type == "Archer") || (attackers[attackerselected].type == "Catapult") || (attackers[attackerselected].type == "Boat") || (attackers[attackerselected].type == "Ship") || (attackers[attackerselected].type == "Battleship") || (attackers[attackerselected].type == "Tridention") || (attackers[attackerselected].type == "Ice Fortress"))
			{
				document.getElementById("noretalbox").checked = false;
				document.getElementById("noretaltext").style.visibility = "hidden";
			}
		}
		if (astring == null)
		{
			astring = "";
		}
		if (cstring == null)
		{
			cstring = "";
		}

		if (extinfo.length >= entries)
		{
			extinfo.pop();
		}
		extinfo.splice(0, 0, "<span style='border-top: 1px dashed black; display: block; max-width: 350px;'></span><p class='ext'>" + unit1 + unit2 + "</p><p class='ext'>" + astring + "</p><p class='ext'>" + bstring + "</p><p class='ext'>" + cstring + "</p>");
		document.getElementById("extendedinfo").innerHTML = extinfo.join("");

		if (mode != "Multi")
		{
			scrollanchor.scrollIntoView(false);
		}
	}
}
function defcheck()
{
	var test = document.getElementById("def2").checked;
	if (test == true)
	{
		document.getElementById("def2").checked = false;
	}
}
function wallcheck()
{
	var test = document.getElementById("def1").checked;
	if (test == true)
	{
		document.getElementById("def1").checked = false;
	}
}
function setdefbonus()
{
	var test = document.getElementById("def1").checked;
	if (test == true)
	{
		document.getElementById("def1").checked = false;
	}
	else
	{
		document.getElementById("def1").checked = true;
	}
	defcheck();
}
function setwallbonus()
{
	var test = document.getElementById("def2").checked;
	if (test == true)
	{
		document.getElementById("def2").checked = false;
	}
	else
	{
		document.getElementById("def2").checked = true;
	}
	wallcheck();
}
function attackerfill()
{
	var getattacker = document.getElementById("selectattacker").value;
	switch (getattacker)
	{
		case "Warrior":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Rider":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Defender":
			document.getElementById("attack").value = "1";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Swordsman":
			document.getElementById("attack").value = "3";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Archer":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Catapult":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Knight":
			document.getElementById("attack").value = "3.5";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Giant":
			document.getElementById("attack").value = "5";
			document.getElementById("attackhp").value = "40";
			document.getElementById("attackmaxhp").value = "40";
			break;
		case "Boat":
			document.getElementById("attack").value = "1";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Ship":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Battleship":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Amphibian":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Crab":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "40";
			document.getElementById("attackmaxhp").value = "40";
			break;
		case "Tridention":
			document.getElementById("attack").value = "3";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Polytaur":
			document.getElementById("attack").value = "3";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Navalon":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "30";
			document.getElementById("attackmaxhp").value = "30";
			break;
		case "Baby Dragon":
			document.getElementById("attack").value = "3";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Fire Dragon":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "20";
			document.getElementById("attackmaxhp").value = "20";
			break;
		case "Ice Archer":
			document.getElementById("attack").value = "0";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Battle Sled":
			document.getElementById("attack").value = "3";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Ice Fortress":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "20";
			document.getElementById("attackmaxhp").value = "20";
			break;
		case "Gaami":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "30";
			document.getElementById("attackmaxhp").value = "30";
			break;
	}
	document.getElementById("shortatt").innerText = "(" + document.getElementById("attack").value + ")";
	if (getattacker == "Warrior" || getattacker == "Rider" || getattacker == "Defender" || getattacker == "Swordsman" || getattacker == "Archer" || getattacker == "Catapult" || getattacker == "Knight" || getattacker == "Amphibian" || getattacker == "Tridention" || getattacker == "Battle Sled" || getattacker == "Ice Fortress")
	{
		document.getElementById("attvetbox").checked = false;
		document.getElementById("attveterancy").style.display='inline-block';
		document.getElementById("attshiphp").style.display='none';
	}
	else if (getattacker == "Boat" || getattacker == "Ship" || getattacker == "Battleship")
	{
		document.getElementById("attshiphp").style.display='inline-block';
		document.getElementById("attveterancy").style.display='none';
		document.getElementById("attshiphp" + prevattshiphp).style.border = "1px solid #A9A9A9";
		document.getElementById("attshiphp" + prevattshiphp).style.backgroundColor = "";
		document.getElementById("attshiphp10").style.border = "1px solid black";
		document.getElementById("attshiphp10").style.backgroundColor = "#eee";
		prevattshiphp = 10;
	}
	else
	{
		document.getElementById("attveterancy").style.display='none';
		document.getElementById("attshiphp").style.display='none';
	}
}
function defenderfill()
{
	var getdefender = document.getElementById("selectdefender").value;
	switch (getdefender)
	{
		case "Warrior":
			document.getElementById("defense").value = "2";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Rider":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Defender":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Swordsman":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Archer":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Catapult":			
			document.getElementById("defense").value = "0";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Knight":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Giant":
			document.getElementById("defense").value = "4";
			document.getElementById("defensehp").value = "40";
			document.getElementById("defensemaxhp").value = "40";
			break;
		case "Boat":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Ship":
			document.getElementById("defense").value = "2";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Battleship":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Mind Bender":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Amphibian":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Crab":
			document.getElementById("defense").value = "4";
			document.getElementById("defensehp").value = "40";
			document.getElementById("defensemaxhp").value = "40";
			break;
		case "Tridention":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Polytaur":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Navalon":
			document.getElementById("defense").value = "4";
			document.getElementById("defensehp").value = "30";
			document.getElementById("defensemaxhp").value = "30";
			break;
		case "Dragon Egg":
			document.getElementById("defense").value = "2";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Baby Dragon":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Fire Dragon":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "20";
			document.getElementById("defensemaxhp").value = "20";
			break;
		case "Mooni":
			document.getElementById("defense").value = "2";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Ice Archer":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Battle Sled":
			document.getElementById("defense").value = "2";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Ice Fortress":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "20";
			document.getElementById("defensemaxhp").value = "20";
			break;
		case "Gaami":
			document.getElementById("defense").value = "4";
			document.getElementById("defensehp").value = "30";
			document.getElementById("defensemaxhp").value = "30";
			break;
		case "Nature Bunny":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "20";
			document.getElementById("defensemaxhp").value = "20";
			break;
	}
	document.getElementById("shortdef").innerText = "(" + document.getElementById("defense").value + ")";
	if (getdefender == "Warrior" || getdefender == "Rider" || getdefender == "Defender" || getdefender == "Swordsman" || getdefender == "Archer" || getdefender == "Catapult" || getdefender == "Knight" || getdefender == "Amphibian" || getdefender == "Tridention" || getdefender == "Battle Sled" || getdefender == "Ice Fortress")
	{
		document.getElementById("defvetbox").checked = false;
		document.getElementById("defveterancy").style.display='inline-block';
		document.getElementById("defshiphp").style.display='none';
	}
	else if (getdefender == "Boat" || getdefender == "Ship" || getdefender == "Battleship")
	{
		document.getElementById("defshiphp").selectedIndex = "0";
		document.getElementById("defshiphp").style.display='inline';
		document.getElementById("defveterancy").style.display='none';
		document.getElementById("defshiphp" + prevdefshiphp).style.border = "1px solid #A9A9A9";
		document.getElementById("defshiphp" + prevdefshiphp).style.backgroundColor = "";
		document.getElementById("defshiphp10").style.border = "1px solid black";
		document.getElementById("defshiphp10").style.backgroundColor = "#eee";
		prevdefshiphp = 10;
	}
	else
	{
		document.getElementById("defveterancy").style.display='none';
		document.getElementById("defshiphp").style.display='none';
	}
}
function egg(attack)
{
	if (attack > 9000)
	{
		document.getElementById("resultatt").innerHTML = "It's over 9000!!!";
		document.getElementById("note").innerHTML = "There's no way that can be right!";
	}
}
function attackerveteran()
{
	var getattacker = document.getElementById("selectattacker").value;
	var getattveterancy = document.getElementById("attvetbox").checked;
	switch (getattacker)
	{
		case "Warrior":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Rider":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Defender":
			document.getElementById("attack").value = "1";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Swordsman":
			document.getElementById("attack").value = "3";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Archer":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Catapult":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Knight":
			document.getElementById("attack").value = "3.5";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Amphibian":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Tridention":
			document.getElementById("attack").value = "3";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Battle Sled":
			document.getElementById("attack").value = "3";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Ice Fortress":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "20";
			document.getElementById("attackmaxhp").value = "20";
			break;
	}
	var atthp = parseInt(document.getElementById("attackhp").value);
	var attmaxhp = parseInt(document.getElementById("attackmaxhp").value);
	if (getattveterancy == true)
	{
		document.getElementById("attackhp").value = atthp + 5;
		document.getElementById("attackmaxhp").value = attmaxhp + 5;
	}
}
function defenderveteran()
{
	var getdefender = document.getElementById("selectdefender").value;
	var getdefveterancy = document.getElementById("defvetbox").checked;
	switch (getdefender)
	{
		case "Warrior":
			document.getElementById("defense").value = "2";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Rider":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Defender":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Swordsman":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Archer":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Catapult":
			document.getElementById("defense").value = "0";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Knight":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Amphibian":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Tridention":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Battle Sled":
			document.getElementById("defense").value = "2";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Ice Fortress":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "20";
			document.getElementById("defensemaxhp").value = "20";
			break;
	}
	var defhp = parseInt(document.getElementById("defensehp").value);
	var defmaxhp = parseInt(document.getElementById("defensemaxhp").value);
	if (getdefveterancy == true)
	{
		document.getElementById("defensehp").value = defhp + 5;
		document.getElementById("defensemaxhp").value = defmaxhp + 5;
	}
}
function attackershiphp(selectattshiphp)
{
	var getattacker = document.getElementById("selectattacker").value;
	var getattshiphp = selectattshiphp;
	
	document.getElementById("attshiphp" + prevattshiphp).style.border = "1px solid #A9A9A9";
	document.getElementById("attshiphp" + prevattshiphp).style.backgroundColor = "";
	document.getElementById("attshiphp" + selectattshiphp).style.border = "1px solid black";
	document.getElementById("attshiphp" + prevattshiphp).style.backgroundColor = "";
	document.getElementById("attshiphp" + selectattshiphp).style.backgroundColor = "#eee";
	prevattshiphp = selectattshiphp;
	
	switch (getattacker)
	{
		case "Boat":
			document.getElementById("attack").value = "1";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Ship":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Battleship":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
	}
	
	switch (getattshiphp)
	{
		case 15:
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case 20:
			document.getElementById("attackhp").value = "20";
			document.getElementById("attackmaxhp").value = "20";
			break;
		case 40:
			document.getElementById("attackhp").value = "40";
			document.getElementById("attackmaxhp").value = "40";
			break;
	}
}
function defendershiphp(selectdefshiphp)
{
	var getdefender = document.getElementById("selectdefender").value;
	var getdefshiphp = selectdefshiphp;
	
	document.getElementById("defshiphp" + prevdefshiphp).style.border = "1px solid #A9A9A9";
	document.getElementById("defshiphp" + prevdefshiphp).style.backgroundColor = "";
	document.getElementById("defshiphp" + selectdefshiphp).style.border = "1px solid black";
	document.getElementById("defshiphp" + selectdefshiphp).style.backgroundColor = "#eee";
	prevdefshiphp = selectdefshiphp;
	
	switch (getdefender)
	{
		case "Boat":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Ship":
			document.getElementById("defense").value = "2";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Battleship":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
	}
	switch (getdefshiphp)
	{
		case 15:
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case 20:
			document.getElementById("defensehp").value = "20";
			document.getElementById("defensemaxhp").value = "20";
			break;
		case 40:
			document.getElementById("defensehp").value = "40";
			document.getElementById("defensemaxhp").value = "40";
			break;
	}
}
function refreshatthp()
{
	refatthpcounter++;
	if (refatthpcounter > 1)
	{
		refatthpcounter = 0;
		document.getElementById("attackhp").value = document.getElementById("attackmaxhp").value;
	}
}
function refreshdefhp()
{
	refdefhpcounter++;
	if (refdefhpcounter > 1)
	{
		refdefhpcounter = 0;
		document.getElementById("defensehp").value = document.getElementById("defensemaxhp").value;
	}
}
function numberfocus(focusid)
{
	resetcounters();
	savednumber = document.getElementById(focusid).value;
	document.getElementById(focusid).value = "";
	if ((shortparameter == true) || (document.getElementById("multibutton").innerText == "Single"))
	{
		if (focusid == "attackhp")
		{
			document.getElementById("attackhprem").innerText = "(" + savednumber + "/" + document.getElementById("attackmaxhp").value + ")";
		}
		else
		{
			document.getElementById("defensehprem").innerText = "(" + savednumber + "/" + document.getElementById("defensemaxhp").value + ")";
		}
	}
	else
	{
		document.getElementById(focusid + "rem").innerText = "(" + savednumber + ")";
	}
	document.getElementById(focusid + "rem").style.visibility = "visible";
}
function numberfocusout (focusoutid)
{
	if (document.getElementById(focusoutid).value == "")
	{
		document.getElementById(focusoutid).value = savednumber;
	}
	document.getElementById(focusoutid + "rem").style.visibility = "hidden";
}
function show(shown, hidden)
{
	document.body.scrollTop = document.documentElement.scrollTop = 0;
	document.getElementById(shown).style.display='block';
 	document.getElementById(hidden).style.display='none';
	resetcounters();
	if ((document.getElementById("multibutton").innerText == "Single") && (deleteselected == true))
	{
		messageclear();
		deleteselected = false;
		document.getElementById("deletebutton").innerText = "Delete Units";
	}
	if ((document.getElementById("multibutton").innerText == "Single") && (healselected == true))
	{
		messageclear();
		healselected = false;
		document.getElementById("healbutton").innerText = "+2";
	}
  	return false;
}
function displayextinfo()
{
	tapcounter++;
	if ((tapcounter > 2) && (document.getElementById("extendedinfo").style.display == 'none'))
	{
		tapcounter = 0;
		document.getElementById("extendedinfo").style.display='block';
		if (document.getElementById("multibutton").innerText == "Single")
		{
			states.scrollIntoView();
		}
		else
		{
			submitbutton.scrollIntoView();
		}
	}
	if ((tapcounter > 2) && (document.getElementById("extendedinfo").style.display == 'block'))
	{
		tapcounter = 0;
		document.getElementById("extendedinfo").style.display='none';
		scrollanchor.scrollIntoView(false);
	}
}
function resetcounters()
{
	tapcounter = 0;
	refreshcounter = 0;
	refatthpcounter = 0;
	refdefhpcounter = 0;
	freezecounters = 0;
	prevdefenderselected = -1;
}
function choosetype()
{
	if (document.getElementById("unitselect").innerText == "Create Attacker")
	{
		document.getElementById("unitselect").innerText = "Create Defender";
		document.getElementById("switch1").style.visibility = "hidden";
		document.getElementById("switch2").style.visibility = "visible";
	}
	else
	{
		document.getElementById("unitselect").innerText = "Create Attacker";
		document.getElementById("switch1").style.visibility = "visible";
		document.getElementById("switch2").style.visibility = "hidden";
	}
	
	var unittype = document.getElementById("unitselect").innerText;
	if (unittype == "Create Attacker")
	{
		document.getElementById("attvalues").style.display='block';
		document.getElementById("attack").style.display='none';
		document.getElementById("attvaluetext").style.display='none';
		document.getElementById("attackmaxhp").style.display='none';
		document.getElementById("attmaxhptext").style.display='none';
		document.getElementById("defvalues").style.display='none';
	}
	else if (unittype == "Create Defender")
	{
		document.getElementById("defvalues").style.display='block';
		document.getElementById("defense").style.display='none';
		document.getElementById("defvaluetext").style.display='none';
		document.getElementById("defensemaxhp").style.display='none';
		document.getElementById("defmaxhptext").style.display='none';
		document.getElementById("attvalues").style.display='none';
		document.getElementById("def1").checked = false;
		document.getElementById("def2").checked = false;
	}
}
function multiswitch()
{
	if (document.getElementById("multibutton").innerText == "Multi")
	{
		document.getElementById("submitbutton").style.display='none';
		document.getElementById("createbutton").style.display='inline-block';
		document.getElementById("multibutton").innerText = "Single";
		document.getElementById("deletebutton").style.display='inline-block';
		document.getElementById("healbutton").style.display='inline-block';
		document.getElementById("singlefaq").style.display='none';
		document.getElementById("result").innerText = "Feedback:";
		document.getElementById("createunitbutton").style.display='inline-block';
		document.getElementById("attackerlist").style.display='block';
		document.getElementById("defenderlist").style.display='block';
		document.getElementById("attackersheader").style.display='block';
		document.getElementById("defendersheader").style.display='block';
		document.getElementById("states").style.display='block';
		document.getElementById("def1").checked = false;
		document.getElementById("def2").checked = false;
		document.getElementById("selectattacker").selectedIndex = 0;
		document.getElementById("attshiphp" + prevattshiphp).style.border = "1px solid #A9A9A9";
		document.getElementById("attshiphp" + prevattshiphp).style.backgroundColor = "";
		prevattshiphp = 10;
		document.getElementById("defshiphp" + prevdefshiphp).style.border = "1px solid #A9A9A9";
		document.getElementById("defshiphp" + prevdefshiphp).style.backgroundColor = "";
		prevdefshiphp = 10;
		attackerfill();
		document.getElementById("selectdefender").selectedIndex = 0;
		defenderfill();
		document.getElementById("unitselect").innerText = "Create Defender";
		choosetype();
		document.body.scrollTop = document.documentElement.scrollTop = 0;
		resetcounters();
	}
	else
	{
		document.getElementById("submitbutton").style.display='inline-block';
		document.getElementById("createbutton").style.display='none';
		document.getElementById("multibutton").innerText = "Multi";
		document.getElementById("deletebutton").style.display='none';
		document.getElementById("healbutton").style.display='none';
		document.getElementById("singlefaq").style.display='inline-block';
		document.getElementById("result").innerText = "Result:";
		document.getElementById("createunitbutton").style.display='none';
		document.getElementById("attvalues").style.display='block';
		document.getElementById("defvalues").style.display='block';
		document.getElementById("attvalues").style.display='block';
		document.getElementById("attackerlist").style.display='none';
		document.getElementById("defenderlist").style.display='none';
		document.getElementById("attackersheader").style.display='none';
		document.getElementById("defendersheader").style.display='none';
		document.getElementById("states").style.display='none';
		document.body.scrollTop = document.documentElement.scrollTop = 0;
		if (shortparameter == false)
		{
				document.getElementById("attvaluetext").style.display='block';
				document.getElementById("attack").style.display='block';
				document.getElementById("attmaxhptext").style.display='block';
				document.getElementById("attackmaxhp").style.display='block';
				document.getElementById("defvaluetext").style.display='block';
				document.getElementById("defense").style.display='block';
				document.getElementById("defmaxhptext").style.display='block';
				document.getElementById("defensemaxhp").style.display='block';
		}
		resetcounters();
		if (deleteselected == true)
		{
			messageclear();
			deleteselected = false;
			document.getElementById("deletebutton").innerText = "Delete Units";
		}
		if (healselected == true)
		{
			messageclear();
			healselected = false;
			document.getElementById("healbutton").innerText = "+2";
		}
	}
}
function createunit()
{
	resetcounters();
	warning = false;
	if (deleteselected == true)
	{
		deleteselected = false;
		document.getElementById("deletebutton").innerText = "Delete Units";
	}
	if (healselected == true)
	{
		messageclear();
		healselected = false;
		document.getElementById("healbutton").innerText = "+2";
	}
	if (document.getElementById("unitselect").innerText == "Create Attacker")
	{
		var att = parseFloat(document.getElementById("attack").value);
		var atthp = parseInt(document.getElementById("attackhp").value);
		var attorighp = parseInt(document.getElementById("attackhp").value);
		var attmaxhp = parseInt(document.getElementById("attackmaxhp").value);
		var attname = document.getElementById("selectattacker").value;

		if ((atthp < 1) || ((document.getElementById("attackhp").value % atthp) != 0) || (atthp > attmaxhp))
		{
			warning = true;
			messageclear();
			document.getElementById("resultatt").innerHTML = "One or more invalid inputs:<br/>";
			if (atthp < 1)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker current HP can't be lower than 1");
			}
			else if (document.getElementById("attackhp").value != atthp)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker current HP must be a whole number");
			}
			else if (atthp > attmaxhp)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker current HP cannot exceed max HP");
			}
			scrollanchor.scrollIntoView(false);
		}
	}	
	else if (document.getElementById("unitselect").innerText == "Create Defender")
	{
		var def = parseFloat(document.getElementById("defense").value);
		var defhp = parseInt(document.getElementById("defensehp").value);
		var defmaxhp = parseInt(document.getElementById("defensemaxhp").value);
		var defname = document.getElementById("selectdefender").value;
		
		if ((defhp < 1) || ((document.getElementById("defensehp").value % defhp) != 0) || (defhp > defmaxhp))
		{
			warning = true;
			messageclear();
			document.getElementById("resultatt").innerHTML = "One or more invalid inputs:<br/>";
			if (defhp < 1)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender current HP can't be lower than 1");
			}
			else if (document.getElementById("defensehp").value != defhp)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender current HP must be a whole number");
			}
			else if (defhp > defmaxhp)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender current HP cannot exceed max HP");
			}
			scrollanchor.scrollIntoView(false);
		}
	}

	if ((document.getElementById("unitselect").innerText == "Create Attacker") && (warning != true))
	{
		attackers.push({type: attname, a: att, hp: atthp, maxhp: attmaxhp, unavailable: false, defendersattacked: [], originalhp: attorighp});
		var i = attackers.length - 1;
		var decshort = "";
		color = "black";
		
		if (attackers[i].type == "Knight")
		{
			decshort = "<b>3</b>";
		}
		else
		{
			decshort = attackers[i].a;
		}
		attackerlist.insertAdjacentHTML("beforeend", "<div class ='c' id='attacker" + i + "' style='width: 56px; height: 80px; border-style: solid; border-color: " + color + "; display: inline-block; position: relative' onclick='attackselector(" + i + ")'><img src='Attackers/" + attackers[i].type + ".png' height='55' width='55'><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[i].hp + "/" + attackers[i].maxhp + "</div></div>");
		messageclear();
		document.getElementById("resultatt").innerHTML = "Attacker created!";
	}
	else if ((document.getElementById("unitselect").innerText == "Create Defender") && (warning != true))
	{
		var defindicator = "";
		var color = "black";
		messageclear();

		if (document.getElementById("def1").checked == true)
		{
			defindicator = "D";
		}
		else if (document.getElementById("def2").checked == true)
		{
			defindicator = "W";
		}
		if ((defname == "Boat") || (defname == "Ship") || (defname == "Battleship"))
		{
			if (defindicator == "W")
			{
				document.getElementById("note").innerHTML = "Note: " + defname + "s can't benefit from walls! Wall bonus was disregarded.";
				defindicator = "";
			}
		}
		else if ((defname == "Catapult") || (defname == "Mind Bender") || (defname == "Giant") || (defname == "Navalon") || (defname == "Crab") || (defname == "Baby Dragon") || (defname == "Fire Dragon") || (defname == "Mooni") || (defname == "Battle Sled") || (defname == "Ice Fortress") || (defname == "Gaami"))
		{
			if (defindicator == "W")
			{
				if (defname == "Catapult")
				{
					document.getElementById("note").innerHTML ="Note: Catapults can't benefit any from defense bonuses due to their 0 defense value!";
					defindicator = "";
				}
				else if ((defname == "Mooni") || (defname == "Ice Fortress"))
				{
					document.getElementById("note").innerHTML = "Note: " + defname + "es don't receive the defense bonus from cities! Wall bonus was disregarded.";
					defindicator = "";
				}
				else
				{
					document.getElementById("note").innerHTML = "Note: " + defname + "s don't receive the defense bonus from cities! Wall bonus was disregarded.";
					defindicator = "";
				}
			}
			else if (defindicator == "D")
			{
				if (defname == "Catapult")
				{
					document.getElementById("note").innerHTML ="Note: Catapults can't benefit any from defense bonuses due to their 0 defense value!";
					defindicator = "";
				}
				else if ((defname == "Mooni") || (defname == "Ice Fortress"))
				{
					document.getElementById("note").innerHTML = "Note: " + defname + "es don't receive the defense bonus from cities!";
				}
				else
				{
					document.getElementById("note").innerHTML = "Note: " + defname + "s don't receive the defense bonus from cities!";
				}
			}
		}	
		else if (defname == "Nature Bunny")
		{
			if (defindicator == "W")
			{
				document.getElementById("note").innerHTML = "Nature bunnies can't capture cities! Wall bonus was disregarded.";
				defindicator = "";
			}
			else if (defindicator == "D")
			{
				document.getElementById("note").innerHTML = "Nature bunnies can't capture cities and don't have any defensive technologies! Defense bonus was disregarded.";
				defindicator = "";
			}
		}
		defenders.push({type: defname, d: def, hp: defhp, maxhp: defmaxhp, defbonus: defindicator, frozen: false});
		var i = defenders.length - 1;
		defenderlist.insertAdjacentHTML("beforeend", "<div class ='c' id='defender" + i + "' style='width: 56px; height: 80px; border-style: solid; border-color: " + color + "; display: inline-block; position: relative' onclick='defenseselector(" + i + ")'><img src='Defenders/" + defenders[i].type + ".png' height='55' width='55'><div style='position: absolute; top: 1px; right: 1px'><b>" + defenders[i].defbonus + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + defenders[i].d + "/" + defenders[i].hp + "/" + defenders[i].maxhp + "</div></div>");
		document.getElementById("resultatt").innerHTML = "Defender created!";
	}
}
function deleteunitprompt()
{
	resetcounters();
	if (healselected == true)
	{
		healselected = false;
		document.getElementById("healbutton").innerText = "+2";
	}
	if ((attackers.length < 1) && (defenders.length < 1) && (deleteselected == false))
	{
		messageclear();
		document.getElementById("resultatt").innerHTML = "There are no units to delete!";
		scrollanchor.scrollIntoView(false);
	}
	else if (deleteselected == false)
	{
		deleteselected = true;
		messageclear();
		document.getElementById("resultatt").innerHTML = "Select units to delete them. Tap or click the Delete Units button again to stop deleting.";
		document.getElementById("deletebutton").innerText = "Delete Units(x)";
		if (attackerselected >= 0)
		{
			var divselected = "attacker" + attackerselected;
			if(attackers[attackerselected].unavailable != true)
			{
				if ((attackers[attackerselected].type == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
				{
					var splashindicator = "";
					var decshort = attackers[attackerselected].a;
					attackers[attackerselected].unavailable = true;
					document.getElementById(divselected).style.borderColor = "gray";
					document.getElementById("attacker" + attackerselected).innerHTML = "<img src='Attackers/" + attackers[attackerselected].type + ".png' height='55' width='55'><div id='splash" + attackerselected + "' style='position: absolute; top: 1px; right: 1px'><b>" + splashindicator + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[attackerselected].hp + "/" + attackers[attackerselected].maxhp + "</div>";
				}
				else
				{
					document.getElementById(divselected).style.borderColor = "black";
					if (document.getElementById("noretaltext").style.visibility == "visible")
					{
						document.getElementById("noretalbox").checked = false;
						document.getElementById("noretaltext").style.visibility = "hidden";
					}
				}
			}
			else
			{
				document.getElementById(divselected).style.borderColor = "gray";
				if (document.getElementById("noretaltext").style.visibility == "visible")
				{
					document.getElementById("noretalbox").checked = false;
					document.getElementById("noretaltext").style.visibility = "hidden";
				}
			}
			attackerselected = -1;
			defenderselected = -1;
			prevattackerselected = -2;
			prevdefenderselected = -1;
		}
	}
	else
	{
		deleteselected = false;
		messageclear();
		document.getElementById("resultatt").innerHTML = "Unit deletion deactivated.";
		document.getElementById("deletebutton").innerText = "Delete Units";
	}
}
function deleteunit(type)
{
	var selectedelement = "";
	var elementid ="";
	var test = "";
	resetcounters();
	if (type == "Attacker")
	{
		attackers.splice(attackerselected, 1);
		selectedelement = "attacker" + attackerselected;
		elementid = document.getElementById(selectedelement);
		elementid.parentNode.removeChild(elementid);
		for (i = attackerselected; i < attackers.length; i++)
		{
			selectedelement = "attacker" + (i + 1);
			elementid = "attacker" + i;
			document.getElementById(selectedelement).setAttribute("onclick", "attackselector(" + i + ")");
			document.getElementById(selectedelement).setAttribute("id", elementid);
		}
	}
	if (type == "Defender")
	{
		defenders.splice(defenderselected, 1);
		selectedelement = "defender" + defenderselected;
		elementid = document.getElementById(selectedelement);
		elementid.parentNode.removeChild(elementid);
		for (i = defenderselected; i < defenders.length; i++)
		{
			selectedelement = "defender" + (i + 1);
			elementid = "defender" + i;
			document.getElementById(selectedelement).setAttribute("onclick", "defenseselector(" + i + ")");
			document.getElementById(selectedelement).setAttribute("id", elementid);
		}
	}
	if ((attackers.length == 0) && (defenders.length == 0))
	{
		deleteselected = false;
		messageclear();
		document.getElementById("resultatt").innerHTML = "All units deleted. Unit deletion deactivated.";
		document.getElementById("deletebutton").innerText = "Delete Units";
	}
	attackerselected = -1;
	defenderselected = -1;
	prevattackerselected = -2;
	prevdefenderselected = -1;
}
function healunitprompt()
{
	resetcounters();
	if (deleteselected == true)
	{
		deleteselected = false;
		document.getElementById("deletebutton").innerText = "Delete Units";
	}
	if ((attackers.length < 1) && (defenders.length < 1) && (healselected == false))
	{
		messageclear();
		document.getElementById("resultatt").innerHTML = "There are no units to heal!";
		scrollanchor.scrollIntoView(false);
	}
	else if (healselected == false)
	{
		healselected = true;
		messageclear();
		document.getElementById("resultatt").innerHTML = "Select units to heal them for +2 HP. You can select the same unit any number of times. Tap or click the +2 button again to stop healing.";
		document.getElementById("healbutton").innerText = "+2(x)";
		if (attackerselected >= 0)
		{
			var divselected = "attacker" + attackerselected;
			if(attackers[attackerselected].unavailable != true)
			{
				if ((attackers[attackerselected].type == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
				{
					var splashindicator = "";
					var decshort = attackers[attackerselected].a;
					attackers[attackerselected].unavailable = true;
					document.getElementById(divselected).style.borderColor = "gray";
					document.getElementById("attacker" + attackerselected).innerHTML = "<img src='Attackers/" + attackers[attackerselected].type + ".png' height='55' width='55'><div id='splash" + attackerselected + "' style='position: absolute; top: 1px; right: 1px'><b>" + splashindicator + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[attackerselected].hp + "/" + attackers[attackerselected].maxhp + "</div>";
				}
				else
				{
					document.getElementById(divselected).style.borderColor = "black";
					if (document.getElementById("noretaltext").style.visibility == "visible")
					{
						document.getElementById("noretalbox").checked = false;
						document.getElementById("noretaltext").style.visibility = "hidden";
					}
				}
			}
			else
			{
				document.getElementById(divselected).style.borderColor = "gray";
				if (document.getElementById("noretaltext").style.visibility == "visible")
				{
					document.getElementById("noretalbox").checked = false;
					document.getElementById("noretaltext").style.visibility = "hidden";
				}
			}
			attackerselected = -1;
			defenderselected = -1;
			prevattackerselected = -2;
			prevdefenderselected = -1;
		}
	}
	else
	{
		healselected = false;
		messageclear();
		document.getElementById("resultatt").innerHTML = "Heal deactivated.";
		document.getElementById("healbutton").innerText = "+2";
	}
}
function healunit(type)
{
	var selectedelement = "";
	var elementid ="";
	var test = "";
	resetcounters();
	if (type == "Attacker")
	{
		var decshort = attackers[attackerselected].a;
		if (attackers[attackerselected].type == "Knight")
		{
			decshort = "<b>3</b>";
		}
		selectedelement = "attacker" + attackerselected;
		elementid = document.getElementById(selectedelement);
		if (attackers[attackerselected].hp == attackers[attackerselected].maxhp)
		{
			messageclear();
			document.getElementById("resultatt").innerHTML = "Attacker already at max HP!";
		}
		else
		{
			attackers[attackerselected].hp = attackers[attackerselected].hp + 2;
			if (attackers[attackerselected].hp > attackers[attackerselected].maxhp)
			{
				attackers[attackerselected].hp = attackers[attackerselected].maxhp;
			}
			document.getElementById(selectedelement).innerHTML = "<img src='Attackers/" + attackers[attackerselected].type + ".png' height='55' width='55'><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[attackerselected].hp + "/" + attackers[attackerselected].maxhp + "</div>";
			messageclear();
			document.getElementById("resultatt").innerHTML = "Attacker " + attackers[attackerselected].type + " [" + (attackerselected + 1) + "] healed. New HP: " + attackers[attackerselected].hp + "/" + attackers[attackerselected].maxhp;
		}
	}
	if (type == "Defender")
	{
		var decshort = defenders[defenderselected].d;
		selectedelement = "defender" + defenderselected;
		elementid = document.getElementById(selectedelement);
		if (defenders[defenderselected].hp == defenders[defenderselected].maxhp)
		{
			messageclear();
			document.getElementById("resultatt").innerHTML = "Defender already at max HP!";
		}
		else
		{
			defenders[defenderselected].hp = defenders[defenderselected].hp + 2;
			if (defenders[defenderselected].hp > defenders[defenderselected].maxhp)
			{
				defenders[defenderselected].hp = defenders[defenderselected].maxhp;
			}
			document.getElementById(selectedelement).innerHTML = "<img src='Defenders/" + defenders[defenderselected].type + ".png' height='55' width='55'><div style='position: absolute; top: 1px; right: 1px'><b>" + defenders[defenderselected].defbonus + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + defenders[defenderselected].hp + "/" + defenders[defenderselected].maxhp + "</div>";
			messageclear();
			document.getElementById("resultatt").innerHTML = "Defender " + defenders[defenderselected].type + " [" + (defenderselected + 1) + "] healed. New HP: " + defenders[defenderselected].hp + "/" + defenders[defenderselected].maxhp;
		}
		if ((defenders[defenderselected].hp == 1) || (defenders[defenderselected].hp == 2))
		{
			document.getElementById(selectedelement).style.borderColor = "black";
		}
	}
	attackerselected = -1;
	defenderselected = -1;
	prevattackerselected = -2;
	prevdefenderselected = -1;
}
function attackselector(attackernumber)
{
	attackerselected = attackernumber;
	if (deleteselected == true)
	{
		deleteunit("Attacker");
	}
	else if (healselected == true)
	{
		healunit("Attacker");
	}
	else
	{
		if ((attackers[attackerselected].type == "Archer") || (attackers[attackerselected].type == "Catapult") || (attackers[attackerselected].type == "Boat") || (attackers[attackerselected].type == "Ship") ||
			(attackers[attackerselected].type == "Battleship") || (attackers[attackerselected].type == "Tridention") || (attackers[attackerselected].type == "Fire Dragon") || (attackers[attackerselected].type == "Ice Fortress"))
		{
			if ((attackers[attackerselected].type == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
			{
				document.getElementById("noretalbox").checked = true;
				document.getElementById("noretaltext").style.visibility = "hidden";
			}
			else
			{
				if(attackers[attackerselected].unavailable == true)
				{
					document.getElementById("noretalbox").checked = false;
					document.getElementById("noretaltext").style.visibility = "hidden";
				}
				else
				{
					if (noretalswitch == true)
					{
						document.getElementById("noretalbox").checked = true;
					}
					else
					{
						document.getElementById("noretalbox").checked = false;
					}
					document.getElementById("noretaltext").style.visibility = "visible";
				}
			}
		}
		else
		{
			document.getElementById("noretalbox").checked = false;
			document.getElementById("noretaltext").style.visibility = "hidden";
		}
		divselected = "";
		divselected = "attacker" + attackerselected;
		if(attackers[attackerselected].unavailable != true)
		{
			document.getElementById(divselected).style.borderColor = "green";
		}
		if ((prevattackerselected != -2) && (prevattackerselected != attackerselected))
		{
			divselected = "attacker" + prevattackerselected;
			if (attackers[prevattackerselected].unavailable == true)
			{
				document.getElementById(divselected).style.borderColor = "gray";
			}
			else if ((attackers[prevattackerselected].type == "Fire Dragon") && (attackers[prevattackerselected].defendersattacked.length > 0))
			{
				var splashindicator = "";
				var decshort = attackers[prevattackerselected].a;
				attackers[prevattackerselected].unavailable = true;
				document.getElementById(divselected).style.borderColor = "gray";
				document.getElementById("attacker" + prevattackerselected).innerHTML = "<img src='Attackers/" + attackers[prevattackerselected].type + ".png' height='55' width='55'><div id='splash" + prevattackerselected + "' style='position: absolute; top: 1px; right: 1px'><b>" + splashindicator + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[prevattackerselected].hp + "/" + attackers[prevattackerselected].maxhp + "</div>";
			}
			else
			{
				document.getElementById(divselected).style.borderColor = "black";
			}
		}
		else if ((prevattackerselected != -2) && (prevattackerselected == attackerselected))
		{
			divselected = "attacker" + prevattackerselected;
			if (attackers[prevattackerselected].unavailable == true)
			{
				document.getElementById(divselected).style.borderColor = "gray";
				document.getElementById("noretalbox").checked = false;
				document.getElementById("noretaltext").style.visibility = "hidden";
			}
			else if (attackers[prevattackerselected].defendersattacked.length > 0)
			{
				document.getElementById(divselected).style.borderColor = "gray";
				attackers[prevattackerselected].unavailable = true;
				document.getElementById("noretalbox").checked = false;
				document.getElementById("noretaltext").style.visibility = "hidden";
				if (attackers[prevattackerselected].type == "Fire Dragon")
				{
					var splashindicator = "";
					var decshort = attackers[prevattackerselected].a;
					document.getElementById("attacker" + prevattackerselected).innerHTML = "<img src='Attackers/" + attackers[prevattackerselected].type + ".png' height='55' width='55'><div id='splash" + prevattackerselected + "' style='position: absolute; top: 1px; right: 1px'><b>" + splashindicator + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[prevattackerselected].hp + "/" + attackers[prevattackerselected].maxhp + "</div>";
				}
			}
			else
			{
				document.getElementById(divselected).style.borderColor = "black";
				document.getElementById("noretalbox").checked = false;
				document.getElementById("noretaltext").style.visibility = "hidden";
			}
		}
		if (prevattackerselected == attackerselected)
		{
			attackerselected = -1;
			prevattackerselected = -2;
		}
		else
		{
			prevattackerselected = attackerselected;
		}
	}
}
function noretalboxcheck()
{
	var test = document.getElementById("noretalbox").checked;
	if (test == true)
	{
		document.getElementById("noretalbox").checked = false;
	}
	else
	{
		document.getElementById("noretalbox").checked = true;
	}
}
function defenseselector(defendernumber)
{
	defenderselected = defendernumber;
	if (deleteselected == true)
	{
		deleteunit("Defender");
	}
	else if (healselected == true)
	{
		healunit("Defender");
	}
	else
	{
		if (attackerselected == -1 && defenders[defenderselected].hp > 0 && defenders[defenderselected].frozen == false)
		{
			if (prevdefenderselected != defenderselected)
			{
				freezecounter = 0;
			}
			freezecounter = freezecounter + 1;
			if (freezecounter == 1)
			{
				messageclear();
				document.getElementById("resultatt").innerHTML = 'Opting to freeze ' + defenders[defenderselected].type + ' [' + (defenderselected + 1) + ']. Press on the same defender two more times to confirm.';
			}
			else if (freezecounter == 2)
			{
				messageclear();
				document.getElementById("resultatt").innerHTML = 'Opting to freeze ' + defenders[defenderselected].type + ' [' + (defenderselected + 1) + ']. Press on the same defender one more time to confirm.';
			}
			else if (freezecounter == 3)
			{
				messageclear();
				freezecounter = 0;
				document.getElementById("resultatt").innerHTML = 'Defender ' + defenders[defenderselected].type + ' [' + (defenderselected + 1) + '] frozen!';
				defenders[defenderselected].frozen = true;
				document.getElementById("defender" + defenderselected).style.borderColor = "blue";
			}
			prevdefenderselected = defenderselected;
		}
		else if (attackerselected == -1 && defenders[defenderselected].hp > 0 && defenders[defenderselected].frozen == true)
		{
			if (prevdefenderselected != defenderselected)
			{
				freezecounter = 0;
			}
			freezecounter = freezecounter + 1;
			if (freezecounter == 1)
			{
				messageclear();
				document.getElementById("resultatt").innerHTML = 'Opting to unfreeze ' + defenders[defenderselected].type + ' [' + (defenderselected + 1) + ']. Press on the same defender two more times to confirm.';
			}
			else if (freezecounter == 2)
			{
				messageclear();
				document.getElementById("resultatt").innerHTML = 'Opting to unfreeze ' + defenders[defenderselected].type + ' [' + (defenderselected + 1) + ']. Press on the same defender one more time to confirm.';
			}
			else if (freezecounter == 3)
			{
				messageclear();
				freezecounter = 0;
				document.getElementById("resultatt").innerHTML = 'Defender ' + defenders[defenderselected].type + ' [' + (defenderselected + 1) + '] unfrozen!';
				defenders[defenderselected].frozen = false;
				document.getElementById("defender" + defenderselected).style.borderColor = "black";
			}
			prevdefenderselected = defenderselected;
		}
		if (attackerselected != -1)
		{
			if ((defenders[defenderselected].hp > 0) && (attackers[attackerselected].unavailable == false))
			{
				if ((attackers[attackerselected].type == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
				{
					var alreadyattacked = false;
					for (i = 0; i < attackers[prevattackerselected].defendersattacked.length; i++) 	
					{
						if (defenderselected == attackers[attackerselected].defendersattacked[i])
						{
							alreadyattacked = true;
						}
					}
					if (alreadyattacked == false)
					{
						calculate ("Multi");
					}
				}
				else
				{
					calculate ("Multi");
				}
				if ((attackers[attackerselected].type != "Knight") && (attackers[attackerselected].type != "Navalon") && (attackers[attackerselected].type != "Fire Dragon"))
				{
					attackerselected = -1;
					prevattackerselected = -2;
					prevdefenderselected = -1;
				}
				else if (attackers[attackerselected].type == "Fire Dragon")
				{
					if (attackers[attackerselected].unavailable == false)
					{
						var divselected = "attacker" + attackerselected;
						document.getElementById(divselected).style.borderColor = "green";
					}
					else
					{
						attackerselected = -1;
						prevattackerselected = -2;
						prevdefenderselected = -1;
					}
				}
				else
				{
					if (attackers[attackerselected].unavailable == false)
					{
						var divselected = "attacker" + attackerselected;
						document.getElementById(divselected).style.borderColor = "green";
					}
					else
					{
						attackerselected = -1;
						prevattackerselected = -2;
						prevdefenderselected = -1;
					}
				}
			}
		}
	}
}
function createbackup()
{
	resetcounters();
	if (deleteselected == true)
	{
		deleteselected = false;
		document.getElementById("deletebutton").innerText = "Delete Units";
	}
	if (healselected == true)
	{
		healselected = false;
		document.getElementById("healbutton").innerText = "+2";
	}
	if ((attackers.length < 1) && (defenders.length < 1))
	{
		messageclear();
		document.getElementById("resultatt").innerHTML = "At least one unit must be created before saving a state!";
		scrollanchor.scrollIntoView(false);
	}
	else
	{
		if ((attackerselected >= 0) && (attackers[attackerselected].type == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
		{
			var splashindicator = "";
			var decshort = attackers[attackerselected].a;
			var divselected = "attacker" + attackerselected;
			attackers[attackerselected].unavailable = true;
			document.getElementById(divselected).style.borderColor = "gray";
			document.getElementById("attacker" + attackerselected).innerHTML = "<img src='Attackers/" + attackers[attackerselected].type + ".png' height='55' width='55'><div id='splash" + attackerselected + "' style='position: absolute; top: 1px; right: 1px'><b>" + splashindicator + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[attackerselected].hp + "/" + attackers[attackerselected].maxhp + "</div>";
			attackerselected = -1;
			prevattackerselected = -2;
		}
		backupattackers = [];
		backupdefenders = [];
		if (firstbackup == false)
		{
			firstbackup = true;
		}
		for (i = 0; i < attackers.length; i++)
		{
			backupattackers.push({type2: attackers[i].type, a2: attackers[i].a, hp2: attackers[i].hp, maxhp2: attackers[i].maxhp, unavailable2: attackers[i].unavailable, defendersattacked2: attackers[i].defendersattacked.slice(), originalhp2: attackers[i].originalhp});
		}
		for (i = 0; i < defenders.length; i++)
		{
			backupdefenders.push({type2: defenders[i].type, d2: defenders[i].d, hp2: defenders[i].hp, maxhp2: defenders[i].maxhp, defbonus2: defenders[i].defbonus, frozen2: defenders[i].frozen});
		}
		messageclear();
		document.getElementById("resultatt").innerHTML = "State saved!";
		scrollanchor.scrollIntoView(false);
	}
}
function loadbackup()
{
	resetcounters();
	if (deleteselected == true)
	{
		deleteselected = false;
		document.getElementById("deletebutton").innerText = "Delete Units";
	}
	if (healselected == true)
	{
		healselected = false;
		document.getElementById("healbutton").innerText = "+2";
	}
	if (firstbackup == false)
	{
		messageclear();
		document.getElementById("resultatt").innerHTML = "No data available. A state must be saved first!";
		scrollanchor.scrollIntoView(false);
	}
	else
	{
		attackers = [];
		defenders = [];
		attackerselected = -1;
		prevattackerselected = -2;
		for (i = 0; i < backupattackers.length; i++)
		{
			attackers.push({type: backupattackers[i].type2, a: backupattackers[i].a2, hp: backupattackers[i].hp2, maxhp: backupattackers[i].maxhp2, unavailable: backupattackers[i].unavailable2, defendersattacked: backupattackers[i].defendersattacked2.slice(), originalhp: backupattackers[i].originalhp2});
		}
		for (i = 0; i < backupdefenders.length; i++)
		{
			defenders.push({type: backupdefenders[i].type2, d: backupdefenders[i].d2, hp: backupdefenders[i].hp2, maxhp: backupdefenders[i].maxhp2, defbonus: backupdefenders[i].defbonus2, frozen: backupdefenders[i].frozen2});
		}
		document.getElementById("attackerlist").innerHTML = "";
		var decshort = "";
		var splashindicator = ""
		color = "";
		for (i = 0; i < attackers.length; i++) 	
		{
			color = "black";
			if (attackers[i].type == "Knight")
			{
				decshort = "<b>3</b>";
			}
			else
			{
				decshort = attackers[i].a;
			}
			if ((attackers[i].hp < 1) || (attackers[i].unavailable == true))
			{
				color = "gray";
			}
			splashindicator = ""
			if ((attackers[i].type == "Fire Dragon") &&(attackers[i].defendersattacked.length > 0) && (attackers[i].unavailable != true))
			{
				splashindicator = "S";
			}
			attackerlist.insertAdjacentHTML("beforeend", "<div class='c' id='attacker" + i + "' style='width: 56px; height: 80px; border-style: solid; border-color: " + color + "; display: inline-block; position: relative' onclick='attackselector(" + i + ")'><img src='Attackers/" + attackers[i].type + ".png' height='55' width='55'><div id='splash" + i + "' style='position: absolute; top: 1px; right: 1px'><b>" + splashindicator + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[i].hp + "/" + attackers[i].maxhp + "</div></div>");
		}
		document.getElementById("defenderlist").innerHTML = "";
		for (i = 0; i < defenders.length; i++) 	
		{
			color = "black"
			if (defenders[i].hp < 1)
			{
				color = "gray";
			}
			else if (defenders[i].frozen == true)
			{
				color = "blue";
			}
			defenderlist.insertAdjacentHTML("beforeend", "<div class='c' id='defender" + i + "' style='width: 56px; height: 80px; border-style: solid; border-color: " + color + "; display: inline-block; position: relative' onclick='defenseselector(" + i + ")'><img src='Defenders/" + defenders[i].type + ".png' height='55' width='55'><div style='position: absolute; top: 1px; right: 1px'><b>" + defenders[i].defbonus + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + defenders[i].d + "/" + defenders[i].hp + "/" + defenders[i].maxhp + "</div></div>");
		}
		messageclear();
		document.getElementById("resultatt").innerHTML = "State loaded!";
		scrollanchor.scrollIntoView(false);
	}
}
function noretaldefault()
{
	if (noretalswitch == true)
	{
		noretalswitch = false;
		messageclear();
		document.getElementById("resultatt").innerHTML = "Setting changed. Enemy units WILL retaliate on your ranged attacks by default.";
	}
	else
	{
		noretalswitch = true
		messageclear();
		document.getElementById("resultatt").innerHTML = "Setting changed. Enemy units WON'T retaliate on your ranged attacks by default.";
	}
}
function loadelements()
{
	attackerfill();
	defenderfill();
	document.getElementById("main").style.visibility = "visible";
	
	var queryStr = window.location.search;
	if (queryStr == "?short")
	{
		var hiddenelements = document.getElementsByClassName("shorthide");
		var i;
		for (i = 0; i < hiddenelements.length; i++)
		{
			hiddenelements[i].style.display = "none";
		}
		shortparameter = true;
		document.getElementById("shortatt").style.display = "inline";
		document.getElementById("shortdef").style.display = "inline";
		document.getElementById("shortlink").style.display = "none";
		document.getElementById("shorttext").style.display = "none";
	}
}
function expandcontainer(identifier)
{
	var expandindicator = "expandindicator" + identifier;
	var answercontainer = "answercontainer" + identifier;
	
	if (document.getElementById(expandindicator).innerHTML == "+")
	{
		document.getElementById(expandindicator).innerHTML = "-";
		document.getElementById(answercontainer).style.display = "block";
		answersexpanded++;
		if (answersexpanded == 16)
		{
			document.getElementById("expandallindicator1").innerHTML = "- Collapse all";
			document.getElementById("expandallindicator2").innerHTML = "- Collapse all";
		}
	}
	else
	{
		document.getElementById(expandindicator).innerHTML = "+";
		document.getElementById(answercontainer).style.display = "none";
		answersexpanded--;
		if (answersexpanded > 0)
		{
			document.getElementById("expandallindicator1").innerHTML = "+ Expand all";
			document.getElementById("expandallindicator2").innerHTML = "+ Expand all";
		}
	}
}
function expandall(indicator)
{
	if (document.getElementById("expandallindicator1").innerHTML == "+ Expand all")
	{
		var expandindicator = "";
		var answercontainer = "";
		
		for (i = 0; i < 16; i++)
		{
			expandindicator = "expandindicator" + i;
			answercontainer = "answercontainer" + i;
			if (document.getElementById(expandindicator).innerHTML == "+")
			{
				document.getElementById(expandindicator).innerHTML = "-";
				document.getElementById(answercontainer).style.display = "block";
			}
		}
		answersexpanded = 16;
		document.getElementById("expandallindicator1").innerHTML = "- Collapse all";
		document.getElementById("expandallindicator2").innerHTML = "- Collapse all";
		if (indicator == 2)
		{
			expandallindicator2.scrollIntoView(false);
		}
	}
	else
	{
		var expandindicator = "";
		var answercontainer = "";
		
		for (i = 0; i < 16; i++)
		{
			expandindicator = "expandindicator" + i;
			answercontainer = "answercontainer" + i;
			if (document.getElementById(expandindicator).innerHTML == "-")
			{
				document.getElementById(expandindicator).innerHTML = "+";
				document.getElementById(answercontainer).style.display = "none";
			}
		}
		answersexpanded = 0;
		document.getElementById("expandallindicator1").innerHTML = "+ Expand all";
		document.getElementById("expandallindicator2").innerHTML = "+ Expand all";
		if (indicator == 2)
		{
			expandallindicator2.scrollIntoView(false);
		}
	}
}
function refreshattackers()
{
	var availabilitycheck = false;
	if (refreshcounter == 0)
	{
		for (i = 0; i < attackers.length; i++)
		{
			if ((attackers[i].unavailable == true) && (attackers[i].hp > 0))
			{
				availabilitycheck = true;
				break;
			}
			if ((attackers[i].type == "Fire Dragon") && (attackers[i].unavailable == false) && (attackers[i].defendersattacked.length > 0))
			{
				availabilitycheck = true;
				break;
			}
		}
	}
	if ((availabilitycheck == false) && (refreshcounter == 0))
	{
		messageclear();
		document.getElementById("resultatt").innerHTML = "There are no valid attackers that can be refreshed.";
	}
	else if ((availabilitycheck == true) || (refreshcounter > 0))
	{
		refreshcounter++;
		if (refreshcounter == 1)
		{
			messageclear();
			document.getElementById("resultatt").innerHTML = 'Opting to refresh all valid attackers. Press "Attackers:" two more times to confirm.';
		}
		else if (refreshcounter == 2)
		{
			messageclear();
			document.getElementById("resultatt").innerHTML = 'Opting to refresh all valid attackers. Press "Attackers:" one more time to confirm.';
		}
		else if (refreshcounter == 3)
		{
			for (i = 0; i < attackers.length; i++)
			{
				if ((attackers[i].unavailable == true) && (attackers[i].hp > 0))
				{
					attackers[i].unavailable = false;
					attackers[i].defendersattacked = [];
					document.getElementById("attacker" + i).style.borderColor = "black";
				}
				if (document.getElementById("attacker" + i).style.borderColor == "green")
				{
					document.getElementById("attacker" + i).style.borderColor = "black";
					attackers[i].defendersattacked = [];
					if (attackers[i].type == "Fire Dragon")
					{
						document.getElementById("splash" + i).innerHTML = "<b> </b>";
						attackers[i].originalhp = attackers[i].hp;
					}
				}
			}
			if (deleteselected == true)
			{
				deleteselected = false;
				document.getElementById("deletebutton").innerText = "Delete Units";
				
			}
			attackerselected = -1;
			prevattackerselected = -2;
			refreshcounter = 0;
			messageclear();
			document.getElementById("resultatt").innerHTML = 'Attackers refreshed!';
		}
	}
}
</script>

<noscript>
	<h2>Polytopia Battle Calculator</h2>
	<i style="display: inline-block">(Created by FrothFrenzy, changed by Sierk Rosema)</i>
	<p>Javascript is required to use the calculator.</p>
	<p>The code of this project can be found at <a href="https://github.com/swrosema/Polytopia_calculator">GitHub repository</a>.</p>
</noscript>
<div id="main" style="visibility: hidden">
	<h2>Polytopia Battle Calculator</h2>
	<span style="display: inline-block"><i>(Created by FrothFrenzy, changed by Sierk Rosema)</i></span>

	<form id="values" onsubmit="return false" onkeypress="if (document.getElementById('multibutton').innerText == 'Single') {return event.keyCode != 13;}">
	
	<p><label class="creationcontainer" id="createunitbutton" onclick="choosetype()" style="width: 185px; display: none; margin-bottom: 8px;">
		<span id="unitselect" style="font-size: 17px; padding-left: 1px; padding-top: 4px; padding-bottom: 4px; width: 152px; float: left;">Create Attacker</span><img src="Other/Switch1.png" alt="Image Switcher" id="switch1" height="20" width="20" style="position: absolute; margin-left: 10px; padding-top: 4px; visibility: visible;"><img src="Other/Switch2.png" alt="Image Switcher" id="switch2" height="20" width="20" style="position: absolute; margin-left: 10px; padding-top: 4px; visibility: hidden;">
	</label></p>
	<div id="attvalues">
		<select id="selectattacker" class= "mselect" onchange="attackerfill()" style="position: relative" tabindex="-1">
 			<option value="Warrior">Warrior
		 	<option value="Rider">Rider
			<option value="Defender">Defender
			<option value="Swordsman">Swordsman
			<option value="Archer">Archer
			<option value="Catapult">Catapult
			<option value="Knight">Knight
			<option value="Giant">Giant
			<option value="Boat">Boat
			<option value="Ship">Ship
			<option value="Battleship">Battleship
			<option value="Amphibian">Amphibian
			<option value="Crab">Crab
			<option value="Tridention">Tridention
			<option value="Polytaur">Polytaur
			<option value="Navalon">Navalon
			<option value="Baby Dragon">Baby Dragon
			<option value="Fire Dragon">Fire Dragon
			<option value="Ice Archer">Ice Archer
			<option value="Battle Sled">Battle Sled
			<option value="Ice Fortress">Ice Fortress
			<option value="Gaami">Gaami
		</select>
		
		<label class="container" id="attveterancy" onclick="attackerveteran()" style="display: none; position: absolute; margin-left: 4px;">
			<span style="margin-right: 28px">Veteran?</span>
			<input type="checkbox" id="attvetbox" style="visibility: hidden">
			<span class="checkmark"></span>
		</label>
		
		<span id="attshiphp" style="display: none; position: absolute; margin-left: 4px;">
			<label id="attshiphp10" class="shiphpcontainer" onclick="attackershiphp(10)">
				<span>10</span>
			</label>
			<label id="attshiphp15" class="shiphpcontainer" onclick="attackershiphp(15)">
				<span>15</span>
			</label>
			<label id="attshiphp20" class="shiphpcontainer" onclick="attackershiphp(20)">
				<span>20</span>
			</label>
			<label id="attshiphp40" class="shiphpcontainer" onclick="attackershiphp(40)">
				<span>40</span>
			</label>
		</span>
		<p class="shorthide" id="attvaluetext">Attacker attack value: <span id="attackrem" style="color: darkgray; visibility: hidden;"></span></p>
		<input type="number" id="attack" class="minput shorthide" onfocusin="numberfocus('attack')" onfocusout="numberfocusout('attack')" min="0" step="0.5" required tabindex="1">
		<p><span class="textpress" onclick="refreshatthp()">Attacker current HP: </span><span id="attackhprem" style="color: darkgray; visibility: hidden;"></span></p>
		<input type="number" id="attackhp" class="minput" onfocusin="numberfocus('attackhp')" onfocusout="numberfocusout('attackhp')" min="1" required tabindex="2"><span id="shortatt" style="display: none; font-size: 17px; margin-left: 4px;"></span>
		
		<p class="shorthide" id="attmaxhptext">Attacker max HP: <span id="attackmaxhprem" style="color: darkgray; visibility: hidden;"></span></p>
		<input type="number" id="attackmaxhp" class="minput shorthide" onfocusin="numberfocus('attackmaxhp')" onfocusout="numberfocusout('attackmaxhp')" min="10" required tabindex="3">
	</div>

	<div id="defvalues" style="display: inline;">
		<p><select id="selectdefender" class= "mselect" onchange="defenderfill()" style="position: relative" tabindex="-4">
 			<option value="Warrior">Warrior
	 		<option value="Rider">Rider
			<option value="Defender">Defender
			<option value="Swordsman">Swordsman
			<option value="Archer">Archer
			<option value="Catapult">Catapult
			<option value="Knight">Knight
			<option value="Giant">Giant
			<option value="Boat">Boat
			<option value="Ship">Ship
			<option value="Battleship">Battleship
			<option value="Mind Bender">Mind Bender
			<option value="Amphibian">Amphibian
			<option value="Crab">Crab
			<option value="Tridention">Tridention
			<option value="Polytaur">Polytaur
			<option value="Navalon">Navalon
			<option value="Dragon Egg">Dragon Egg
			<option value="Baby Dragon">Baby Dragon
			<option value="Fire Dragon">Fire Dragon
			<option value="Mooni">Mooni
			<option value="Ice Archer">Ice Archer
			<option value="Battle Sled">Battle Sled
			<option value="Ice Fortress">Ice Fortress
			<option value="Gaami">Gaami
			<option value="Nature Bunny">Nature Bunny
		</select>

		<label class="container" id="defveterancy" onclick="defenderveteran()" style="display: none; position: absolute; margin-left: 4px;">
			<span style="margin-right: 28px;">Veteran?</span>
			<input type="checkbox" id="defvetbox" style="visibility: hidden">
			<span class="checkmark"></span>
		</label>
		
		<span id="defshiphp" style="display: none; position: absolute; margin-left: 4px;">
			<label id="defshiphp10" class="shiphpcontainer" onclick="defendershiphp(10)">
				<span>10</span>
			</label>
			<label id="defshiphp15" class="shiphpcontainer" onclick="defendershiphp(15)">
				<span>15</span>
			</label>
			<label id="defshiphp20" class="shiphpcontainer" onclick="defendershiphp(20)">
				<span>20</span>
			</label>
			<label id="defshiphp40" class="shiphpcontainer" onclick="defendershiphp(40)">
				<span>40</span>
			</label>
		</span></p>

		<p class="shorthide" id="defvaluetext">Defender defense value: <span id="defenserem" style="color: darkgray; visibility: hidden;"></span></p>
		<input type="number" id="defense" class="minput shorthide" onfocusin="numberfocus('defense')" onfocusout="numberfocusout('defense')" min="0" step="0.5" required tabindex="4">
		<p><span class="textpress" onclick="refreshdefhp()">Defender current HP: </span><span id="defensehprem" style="color: darkgray; visibility: hidden;"></span></p>
		<input type="number" id="defensehp" class="minput" onfocusin="numberfocus('defensehp')" onfocusout="numberfocusout('defensehp')" min="1" required tabindex="5"><span id="shortdef" style="display: none; font-size: 17px; margin-left: 4px;"></span>
		<p class="shorthide" id="defmaxhptext">Defender max HP: <span id="defensemaxhprem" style="color: darkgray; visibility: hidden;"></span></p>
		<input type="number" id="defensemaxhp" class="minput shorthide" onfocusin="numberfocus('defensemaxhp')" onfocusout="numberfocusout('defensemaxhp')" min="10" required tabindex="6">

		<p>
		<label class="container" onclick="setdefbonus()">
			<span style="margin-right: 28px">Defense bonus?</span>
			<input type="checkbox" id="def1" onclick="defcheck()" style="visibility: hidden">
			<span class="checkmark"></span>
		</label>
		<label class="container" onclick="setwallbonus()">
			<span style="margin-right: 28px">Wall bonus?</span>
			<input type="checkbox" id="def2" onclick="wallcheck()" style="visibility: hidden">
			<span class="checkmark"></span>
		</label>
		</p>
	</div>

	<p><button id="submitbutton" type="submit" class="mbutton" onclick="calculate('Single')" tabindex="7">Calculate!</button>
	<button id="createbutton" type="button" class="mbutton" onclick="createunit()" style="display:none">Create Unit!</button>
	<button id="multibutton" type="button" class="mbutton" onclick="multiswitch()">Multi</button>
	<button id="deletebutton" type="button" class="mbutton" onclick="deleteunitprompt()" style="display:none">Delete Units</button>
	<a class="textpress" id="singlefaq" href="#top" onclick="return show('faq', 'main')" target="_top" style="margin-left: 6px">FAQ</a></p>
	</form>

	<p id="attackersheader" style="display:none"><b class="textpress" onclick="refreshattackers()">Attackers:</b></p>
	<div id="attackerlist" style="display:none; width: 325px;"></div>
	<p id="defendersheader" style="display:none"><b class="textpress" onclick="noretaldefault()" style="margin-right: 75px">Defenders:</b>
		
		<label class="container" id="noretaltext" onclick="noretalboxcheck()" style="visibility: hidden; position: relative;">
			<span style="margin-right: 28px">No retaliation?</span>
			<input type="checkbox" id="noretalbox" style="visibility: hidden">
			<span class="checkmark"></span>
		</label>
		
		</p>
	<div id="defenderlist" style="display:none; width: 325px;"></div>

	<p id="states" style="display: none"><button type="button" class="mbutton" onclick="createbackup()">Save State</button>
	<button type="button" class="mbutton" onclick="loadbackup()">Load State</button>
	<button id="healbutton" type="button" class="mbutton" onclick="healunitprompt()">+2</button>
	<a href="#top" class="textpress" onclick="return show('faq', 'main')" target="_top" style="margin-left: 6px">FAQ</a></p>

	<div id="resultcontainer" onclick="displayextinfo()" style="max-width: 800px">
		<p><b id="result">Result:</b><span id="respressindicator">&#9679;</span></p>
	<p id="resultatt"><b><i>14.12.2020: </i></b>This project got picked up by a member of the (Discord) community, <a href="https://discord.com/channels/@me/217385992837922819">@jd#0001</a>! You can find it <a href="https://frothfrenzy.polycalculatorbot.com/">here</a>!<br/><br/><b><i>14.08.2019: </i></b>Final update. Refer to the <a href="https://github.com/frothfrenzy/polytopiacalculator/blob/master/Changelog.md" target="_blank">Changelog</a> for details.<br/><br/><b><i>18.07.2019:</i></b> Added a +2 HP heal button in Multi mode.</p>
		<p id="resultdef">For information on combat mechanics, calculator usage and useful guides or links, read the <a href="#top" onclick="return show('faq', 'main')" target="_top">FAQ</a>.</p>
		<p id="resultsplash"></p>
		<p id="frozennote" class="i"></p>
		<p id="note" class="i"></p>
		<span id="scrollanchor"></span>
		<p id="extendedinfo" class="ext" style="display:none"><span style="border-top: 1px dashed black; padding-top: 10px; display: block; max-width: 350px;"></span>Battle history does not contain any entries yet.</p>
	</div>
</div>

<div id="faq" style="display:none; max-width: 800px">
	<h2>Frequently Asked Questions</h2><br/><br/>
	
<p><a href="javascript:;" class="textpress" style="float: left" onclick="return show('main', 'faq')" target="_top">&lt;&lt;&lt; Back to the calculator!</a><a href="javascript:;" class="textpress" id="expandallindicator1" style="float: right" onclick="expandall(1)">+ Expand all</a></p>
	
	<div class="q" style="border-top: 1px solid; margin-top: 25px;" onclick="expandcontainer(0)">
		<div class="p"><b>How to use the calculator?</b></div>
		<div id="expandindicator0" class="ei">+</div>
	</div>
	<div id="answercontainer0" class="a">
	<p>Simply input all of the fields, click the Calculate! button, and your battle result will pop up at the bottom. All of the fields are required because every variable affects the result. You can use drop-down unit templates to fill the fields quicker, although these can also be useful if you don't remember the unit stats. Additional details such as unit veterancy and variable ship HP will appear next to the template box once you have selected a relevant unit.<br/><br/>When tapping or clicking on number fields to change values, the original value will be deleted to allow for faster input. A reminder containing the previous value will appear next to the corresponding text above. If a new value isn't provided, the previous one is automatically reinstated upon leaving the field.<br/><br/>Defender's current HP is automatically updated if the defender survives, so you can keep pressing Calculate! repeatedly until it is destroyed. This is useful for quickly calculating how many units of the same power are needed to take down a stronger unit, and you don't need to manually change the defender's current HP every time you want to perform an attack with a different unit.<br/><br/>Current HP values can be quickly refreshed by tapping or clicking the text above the current HP box twice (Attacker/Defender current HP:). This will set the attacker's or defender's current HP value equal to its max HP value.<br/><br/>You can access a history of all the recent battles that were performed in the current session. Tap or click three times on "Result:" or any text that appears below it to activate the history. Likewise, you can turn it off by tapping or clicking three times in that same area. The history showcases 10 entries by default. If for some reason you would like to keep a bigger (or smaller) history for the current session, set the attacker current HP value to 123, set the defender current HP value to the number of entries you want to keep and then press the Calculate! button. A message will appear as a confirmation. All entries are formatted as Attacker (stats) - Defender (stats|D/W), where stats are shown in the same order as they appear on the calculator, and D/W representing the defense/wall bonus for the defender.<br/><br/>Also, you can run the shortened version of the calculator if you find the attack, defense and max HP prompts unnecessary, or if you feel they are taking up too much space. To activate the shortened version, simply add the parameter ?short to the end of the calculator's browser URL. Therefore, the end of the URL should look like this:<br/><br/><a href="https://frothfrenzy.github.io/polytopiacalculator/?short">.../polytopiacalculator/?short</a><br/><br/>This hides the redundant info. Attack and defense values will be shown in brackets just right of the current HP input boxes, while the current HP reminder when tapping or clicking to change values will also contain the max HP info. You can add this parameter even if you are running the calculator from a different location.</p>
	</div>
	
	<div class="q" onclick="expandcontainer(1)">
		<div class="p"><b>What is the damage formula?</b></div>
		<div id="expandindicator1" class="ei">+</div>
	</div>
	<div id="answercontainer1" class="a">
		<p>The calculator uses the same formula posted by the developer on the game wikia forums some time ago. You can find a link to this thread on the bottom of this FAQ. Here is the simplified code:</p>
		
		<p>accelerator = 4.5<br/>
		attackForce = attacker.attack * (attacker.health / attacker.maxHealth)<br/>
		defenseForce = defender.defense * (defender.health / defender.maxHealth) * defenseBonus<br/>
		totalDamage = attackForce + defenseForce<br/><br/>
		attackResult = round((attackForce / totalDamage) * attacker.attack * accelerator)<br/>
		defenseResult = round((defenseForce / totalDamage) * defender.defense * accelerator)</p>
	</div>
	
	<div class="q" onclick="expandcontainer(2)">
		<div class="p"><b>To be updated.</b></div>
		<div id="expandindicator2" class="ei">+</div>
	</div>
	<div id="answercontainer2" class="a">
		<p>To be updated.</p>
	</div>
	
	<div class="q" onclick="expandcontainer(3)">
		<div class="p"><b>Is it possible to calculate on the fly?</b></div>
		<div id="expandindicator3" class="ei">+</div>
	</div>
	<div id="answercontainer3" class="a">
		<p>It is to some extent. Follow these guidelines:<br/><br/>- Maximum damage of any unit is its relevant battle value * 4.5, rounded up. Attack value is used when attacking, defense value is used when retaliating.<br/><br/>- Add up the attack and defense values of units participating in the battle, and see how much of each value constitutes the sum in percentages.<br/><br/>- Apply the percentage to the unit's maximum damage to get the battle result. Assuming equal opponents with full HP, this will be 50% for both, which translates into half the maximum damage being dealt by either side. Warriors would deal 5 (4.5) damage to each other, swordsmen would deal 7 (6.75), etc.<br/><br/>- For another example, say a swordsman is attacking a rider - 3 attack value versus 1 defense value, both at full HP. That comes up to 75% of maximum damage for the attacker (10 damage at full HP), and 25% of maximum damage for the defender (1 damage, if it somehow survives the attack).<br/><br/>- Lower HP also affects the result as a percentage, causing the attack and defense values to scale down with the amount of HP lost. Maximum damage stays the same, but only the fraction of the relevant battle value is added to the sum for the purpose of determining constituting percentages. For example, a 5-HP, non-veteran warrior would have 50% less health, which corresponds to 50% less attack value being added to the sum. If he were to attack an enemy warrior with full HP, the sum of their battle values would be 3 instead of 4. Therefore, the attacker would deal about 33% of its maximum damage (3), while the defender would deal about 67% of its maximum damage (6).<br/><br/>- Taking the above example into account, we can conclude that HP loss affects a unit very adversely. Having 1/10 HP allows the unit to use only 10% of its offensive and defensive capabilities, sometimes resulting in that unit dealing no damage at all. Damage received is almost certainly fatal, as the consequently low defense value allows enemy units to deal their maximum damage (or close to it). This also means that 0-defense units like catapults always receive maximum damage regardless of current HP values for either side, while dealing no damage in return.<br/><br/>- Defense bonuses affect retaliation damage in the same way as lost HP does, since it is all calculated together at the same time. See questions below for more details.</p>
	</div>
	
	<div class="q" onclick="expandcontainer(4)">
		<div class="p"><b>How is the defense bonus applied?</b></div>
		<div id="expandindicator4" class="ei">+</div>
	</div>
	<div id="answercontainer4" class="a">
		<p>The defenseForce variable is increased by a factor of 1.5 (defenseBonus = 1.5) if the defender is on a tile that provides a standard defense bonus. If the defender is behind a wall, it's increased by a factor of 4. If no defense bonuses are applied, the defenseBonus variable has a default value of 1.<br/><br/>Because of how the formula works, defense bonuses have less effect on defenders with low HP. There is no effect on defenders with 0 defense value, which will always receive maximum damage regardless of where they are.<br/><br/>Only the defenseForce variable is affected by the increase, so you won't get the correct retaliation result if you were to apply the same factor to the defense value of the unit instead.<br/><br/>Keep in mind that since the Polaris update, all units that can benefit from defense bonuses in cities have the Fortify skill. If a unit can occupy a city but doesn't have this skill - it can't benefit from that city's defense bonus. Units that don't have the Fortify skill are:<br/><br/>Catapults, mind benders, giants, crabs, navalons, baby dragons, fire dragons, moonies, battle sleds, ice fortresses and gaamis.<br/><br/>Perhaps surprisingly, dragon eggs do get the Fortify skill.</p>
	</div>

	<div class="q" onclick="expandcontainer(5)">
		<div class="p"><b>Which tiles provide the standard defense bonus?</b></div>
		<div id="expandindicator5" class="ei">+</div>
	</div>
	<div id="answercontainer5" class="a">
		<p>Non-walled cities and defensive terrain for which you researched the relevant technology - Aquatism for water, Archery for forests and Meditation for mountains. If a player has any of these technologies, their units will have a shield appear around their HP when they are on tiles that provide the bonus. The shield will also appear on units that are in friendly cities, excepting units that don't have the Fortify skill. These units never benefit from defense bonuses in cities, even if they are walled.<br/><br/>For Polaris, the Polarism technology replaces Aquatism and provides the standard defense bonus for friendly units on water tiles that have been turned to ice.<br/><br/>Friendly territory does not in itself grant additional defensive bonuses. It does, however, improve the unit's HP recovery rate (see "How does healing work?" further below).</p>
	</div>

	<div class="q" onclick="expandcontainer(6)">
		<div class="p"><b>How does the retaliation damage work?</b></div>
		<div id="expandindicator6" class="ei">+</div>
	</div>
	<div id="answercontainer6" class="a">
		<p>The unit's defense value is used in place of its attack value to calculate the retaliation damage. This is why some units deal significantly less damage when retaliating, while the defender unit and units with defense bonuses deal more. Because all of the modifiers are already applied before dealing damage takes place, the defender's HP loss doesn't affect its retaliation result. Instead, it deals damage based on HP it had before combat began.</p>
	</div>
	
	<div class="q" onclick="expandcontainer(7)">
		<div class="p"><b>Why is there no option for attacking from a tile that provides a defense bonus?</b></div>
		<div id="expandindicator7" class="ei">+</div>
	</div>
	<div id="answercontainer7" class="a">
		<p>Contrary to popular belief, this has no effect on the result. You forfeit the bonus entirely. Your unit will receive full damage when the enemy unit retaliates.</p>
	</div>
	
	<div class="q" onclick="expandcontainer(8)">
		<div class="p"><b>The defender was destroyed, but no word on what happened to the attacker?</b></div>
		<div id="expandindicator8" class="ei">+</div>
	</div>
	<div id="answercontainer8" class="a">
		<p>If the attack outright destroys the defender, no retaliation takes place. The attacker is unphased, so there's nothing for the calculator to report.</p>
	</div>
	
	<div class="q" onclick="expandcontainer(9)">
		<div class="p"><b>Enemy doesn't retaliate, but here I receive damage anyway. Will this affect my result?</b></div>
		<div id="expandindicator9" class="ei">+</div>
	</div>
	<div id="answercontainer9" class="a">
		<p>No. It doesn't matter if an enemy unit is next to you, away from you, or if it is a ranged unit that doesn't retaliate because you're in your opponent's fog of war. Simply disregard the retaliation damage - the damage you deal is not affected in any of these cases. You can always use Multi mode which does offer the option of no enemy retaliation.</p>
	</div>
	
	<div class="q" onclick="expandcontainer(10)">
		<div class="p"><b>How does healing work?</b></div>
		<div id="expandindicator10" class="ei">+</div>
	</div>
	<div id="answercontainer10" class="a">
		<p>Any damaged unit that does nothing during its turn can recover some of its lost HP instead. The amount is 4 HP if it is in friendly territory, and 2 HP if it is anywhere else. This happens automatically at the end of your turn, but you can choose to do so manually.<br/><br/>There is no specific advantage to manually recovering HP.<br/><br/>Mind benders also have the Heal Others ability which allows them to restore 4 HP to all friendly units adjacent to them. This stacks with the intrinsic Recover ability and heals from other mind benders. You can unlock the mind bender unit by researching Philosophy.</p>
	</div>
	
	<div class="q" onclick="expandcontainer(11)">
		<div class="p"><b>What are veteran units?</b></div>
		<div id="expandindicator11" class="ei">+</div>
	</div>
	<div id="answercontainer11" class="a">
		<p>A unit can be promoted to veteran status once it has destroyed 3 or more units, either via attacks or retaliations. You can promote the unit at any time during your turn, and you can even carry over the reward into following turns. However, you can only promote a unit once this way.<br/><br/>Once promoted, the unit's maximum HP permanently increases by 5 and the unit heals up completely. No other stats are affected. Because of this, it is generally a good idea to hold on to the reward until the unit is seriously damaged in battle.<br/><br/>Some units can't be promoted. This includes all super units (giants, crabs, every form of dragon, gaamis), mind benders, polytaurs, navalons, ice archers and moonies. Boats, ships and battleships can be promoted, but only if the carried unit previously activated the reward on land. This is due to the unit's battle victories at sea not being counted towards achieving its veteran status.<br/><br/>Interestingly, ice archers do have an option to track their battle victories for veteran status. However, their 0.1 attack value is not enough to deal damage, even in the worst case scenario where the defender's defense value is 0.</p>
	</div>
	
	<div class="q" onclick="expandcontainer(12)">
		<div class="p"><b>Where can I see all the unit stats?</b></div>
		<div id="expandindicator12" class="ei">+</div>
	</div>
	<div id="answercontainer12" class="a">
		<p>If you use drop-down unit templates, the calculator will automatically fill all the relevant stats for the selected unit. For more info, you should read the unit page on the game's wikia site. You can find the link to this page at the bottom of this FAQ.</p>
	</div>
	
	<div class="q" onclick="expandcontainer(13)">
		<div class="p"><b>How does the fire dragon's splash damage work?</b></div>
		<div id="expandindicator13" class="ei">+</div>
	</div>
	<div id="answercontainer13" class="a">
		<p>It is calculated in the same way as a regular attack. However, an additional line of code is added at the end:<br/><br/>
		defender.health = defender.health - floor(attackResult / 2)<br/><br/>

		This means that the unit receives half the damage it would normally receive if it was the main target, rounded down. So e.g. if the fire dragon would deal 11 damage to a unit by attacking it directly, that same unit would receive 5 damage (11/2=5.5=5) if it was splashed instead. Since nothing is altered in the original formula, the unit also benefits from its defense bonus, if any. Only the fire dragon's main target can retaliate, provided it survives the initial attack.<br/><br/>
		
		In Single mode, both the main attack and splash damage results are provided to you simultaneously, calculated separately for the same defending unit. You either take one result or the other, depending on your follow-up. This is convenient if you're testing for damage in a group of units, so you can quickly get an idea which unit would be the most optimal to choose for the dragon's main attack. The calculator assumes the main attack will be the follow-up, and deducts that result from the defender's current HP.</p>
	</div>
	
	<div class="q" onclick="expandcontainer(14)">
		<div class="p"><b>How does the Polaris freezing mechanic work?</b></div>
		<div id="expandindicator14" class="ei">+</div>
	</div>
	<div id="answercontainer14" class="a">
		<p>The mechanic is unique to the Polaris tribe, with three of their special units being able to utilize the ability:<br/><br/>

		Ice archers automatically freeze enemy units they attack. Frozen units cannot retaliate against the attack that freezes them nor against any subsequent attacks. The unit remains frozen until the Polaris player's next turn. None of its stats are affected. It's also worth noting that the ice archer itself can't retaliate at all, and its 0.1 attack value is not enough to destroy another unit or deal damage to it under any circumstances. This is why the calculator treats it as 0 instead.<br/><br/>
		
		Moonies can freeze terrain and enemy units adjacent to them as its action that turn, which means it can't both move and use its freeze area ability. This freezes the affected units in the same way as that of the ice archer, but also freezes the terrain. Moonies can't attack nor retaliate.<br/><br/>
		
		Gaami freezes the area around it in the same way as the mooni, but does so automatically after it moves. It can also choose to do so as an action.<br/><br/>
		
		Frozen terrain has several benefits for the Polaris. Refer to the game wikia below for additional details.</p>
	</div>
	
	<div class="q" onclick="expandcontainer(15)">
		<div class="p"><b>Can I use the calculator offline?</b></div>
		<div id="expandindicator15" class="ei">+</div>
	</div>
	<div id="answercontainer15" class="a">
		<p>
        Yes you can. If you don't quit your browser app, you should be able to use the calculator without internet access as long as the browser stays in memory. The calculator is a static website and doesn't require the use of bandwith. Otherwise, most desktop browsers support saving pages so you can store them offline for later use. Some mobile browsers like Chrome also support this.<br/><br/>
        </p>
	</div>
	
	<div style="float: left; position: relative; top: 6px; width: 100%">
		<p><b style="float: left; margin-top: 4px;">Links:</b><a href="javascript:;" class="textpress" id="expandallindicator2" style="float: right" onclick="expandall(2)">+ Expand all</a></p><br/>
		
		<p style="margin-top: 16px">
		<a href="http://www.midjiwan.com/polytopia.html" target="_blank">Official Game Website</a><br/>
		<a href="http://polytopia.wikia.com/wiki/The_Battle_of_Polytopia_Wikia" target="_blank">Wikia</a><br/>
        <a href="https://discord.gg/YTFTuAq?" target="_blank">Discord</a><br/>
		<a href="https://www.reddit.com/r/Polytopia/" target="_blank">Reddit</a><br/><br/>

		<a href="javascript:;" class="textpress" onclick="return show('main', 'faq')" target="_top">&lt;&lt;&lt; Back to the calculator!</a>
        </p><br/>
	</div>
</div>
</body>
</html>
